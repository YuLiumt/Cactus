

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Cactus Configuration Language &mdash; Cactus 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Cactus
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GetStart.html">Get Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Guide/main.html">Thorn Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="ThornWrite.html">Thorn Write</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/main.html">Cactus API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lorene/main.html">Lorene</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Kranc/Kranc.html">Kranc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reference.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cactus</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Cactus Configuration Language</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/note/ThornWrite/ccl.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cactus-configuration-language">
<h1>Cactus Configuration Language<a class="headerlink" href="#cactus-configuration-language" title="Permalink to this headline">¶</a></h1>
<p>Cactus Configuration Language (CCL) files are text files which tells the flesh all it needs to know about the thorns.</p>
<p>CCL files may contain comments introduced by the hash # character, which indicates that the rest of the line is a comment. If the last non-blank character of a line in a CCL file is a backslash \, the following line is treated as a continuation of the current line.</p>
<div class="section" id="the-interface-ccl-file">
<h2>The interface.ccl File<a class="headerlink" href="#the-interface-ccl-file" title="Permalink to this headline">¶</a></h2>
<p>The interface configuration file consists of:</p>
<ul class="simple">
<li><p>A header block giving details of the thorn’s relationship with other thorns.</p></li>
<li><p>A block detailing which include files are used from other thorns, and which include files are provided by this thorn.</p></li>
<li><p>Blocks detailing aliased functions provided or used by this thorn.</p></li>
<li><p>A series of blocks listing the thorn’s global variables.</p></li>
</ul>
<div class="section" id="implementation-name">
<h3>implementation name<a class="headerlink" href="#implementation-name" title="Permalink to this headline">¶</a></h3>
<p>The implementation name is declared by a single line at the top of the file</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">implements</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The implementation name must be unique among all thorns.</p>
</div>
<div class="section" id="inheritance-relationships-between-thorns">
<h3>Inheritance relationships between thorns<a class="headerlink" href="#inheritance-relationships-between-thorns" title="Permalink to this headline">¶</a></h3>
<p>There are two relationship statements that can be used to get variables (actually groups of variables) from other implementations.</p>
<ul>
<li><p>Gets all <strong>Public</strong> variables from implementation &lt;name&gt;, and all variables that &lt;name&gt; has in turn inherited</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">Inherits</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>A thorn cannot inherit from itself. Inheritance is transitive (if A inherits from B, and B inherits from C, then A also implicitly inherits from C), but not commutative.</p>
</div></blockquote>
</li>
<li><p>Gets all <strong>Protected</strong> variables from implementation &lt;name&gt;, but, unlike inherits, it defines a transitive relation by pushing its own implementation’s <strong>Protected</strong> variables onto implementation &lt;name&gt;.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">Friend</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>A thorn cannot be its own friend. Friendship is associative, commutative and transitive (if A is a friend of B, and B is a friend of C, then A is implicitly a friend of C).</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="include-files">
<h3>Include Files<a class="headerlink" href="#include-files" title="Permalink to this headline">¶</a></h3>
<p>Cactus provides a mechanism for thorns to add code to include files which can be used by any other thorn. Such include files can contain executable source code, or header/declaration information.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">INCLUDE</span><span class="p">[</span><span class="n">S</span><span class="p">]</span> <span class="p">[</span><span class="n">SOURCE</span><span class="o">|</span><span class="n">HEADER</span><span class="p">]</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">file_to_include</span><span class="o">&gt;</span> <span class="n">in</span> <span class="o">&lt;</span><span class="n">file_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This indicates that this thorn adds the code in &lt;file to include&gt; to the include file &lt;file name&gt;.</p>
<p>Any thorn which uses the include file must declare this in its <em>interface.ccl</em> with the line</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">USES</span> <span class="n">INCLUDE</span> <span class="p">[</span><span class="n">SOURCE</span><span class="o">|</span><span class="n">HEADER</span><span class="p">]</span><span class="o">:</span> <span class="o">&lt;</span><span class="n">file_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If the optional <code class="docutils literal notranslate"><span class="pre">[SOURCE|HEADER]</span></code> is omitted, <code class="docutils literal notranslate"><span class="pre">HEADER</span></code> is assumed. Note that this can be dangerous, as included source code, which is incorrectly assumed to be header code, will be executed in another thorn even if the providing thorn is inactive. Thus, it is recommended to always include the optional <code class="docutils literal notranslate"><span class="pre">[SOURCE|HEADER]</span></code> specification.</p>
</div>
<div class="section" id="thorn-variables">
<h3>Thorn variables<a class="headerlink" href="#thorn-variables" title="Permalink to this headline">¶</a></h3>
<p>Cactus variables are used instead of local variables for a number of reasons:</p>
<ul class="simple">
<li><p>Cactus variables can be made visible to other thorns, allowing thorns to communicate and share data.</p></li>
<li><p>Cactus variables can be distributed and communicated among processors, allowing parallel computation.</p></li>
<li><p>A database of Cactus variables, and their attributes, is held by the flesh, and this information is used by thorns, for example, for obtaining a list of variables for checkpointing.</p></li>
</ul>
<p>Cactus variables are placed in groups with homogeneous attributes, where the attributes describe properties such as the data type, group type, dimension, ghostsize, number of timelevels, and distribution.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">access</span><span class="o">&gt;:</span><span class="p">]</span>

<span class="o">&lt;</span><span class="n">data_type</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">group_name</span><span class="o">&gt;</span><span class="p">[[</span><span class="o">&lt;</span><span class="n">number</span><span class="o">&gt;</span><span class="p">]]</span> <span class="p">[</span><span class="n">TYPE</span><span class="o">=&lt;</span><span class="n">group_type</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">DIM</span><span class="o">=&lt;</span><span class="n">dim</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">TIMELEVELS</span><span class="o">=&lt;</span><span class="n">num</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">SIZE</span><span class="o">=&lt;</span><span class="n">size</span> <span class="n">in</span> <span class="n">each</span> <span class="n">direction</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">DISTRIB</span><span class="o">=&lt;</span><span class="n">distribution_type</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">GHOSTSIZE</span><span class="o">=&lt;</span><span class="n">ghostsize</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">TAGS</span><span class="o">=&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">]</span>
<span class="p">{</span>
    <span class="o">&lt;</span><span class="n">variable_name</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">&lt;</span><span class="n">variable_name</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">&lt;</span><span class="n">variable_name</span><span class="o">&gt;</span>
<span class="p">}</span> <span class="p">[</span><span class="s">&quot;&lt;group_description&gt;&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Currently, the names of groups and variables must be distinct. The options TYPE, DIM, etc., following &lt;group name&gt; must all appear on one line.</p>
<div class="section" id="access">
<h4>Access<a class="headerlink" href="#access" title="Permalink to this headline">¶</a></h4>
<p>There are three different access levels available for variables</p>
<ul class="simple">
<li><p><strong>Public</strong>: Can be ‘inherited’ by other implementations.</p></li>
<li><p><strong>Protected</strong>: Can be shared with other implementations which declare themselves to be friends of this one.</p></li>
<li><p><strong>Private</strong>: Can only be seen by this thorn.</p></li>
</ul>
<p>By default, all groups are <strong>private</strong>, to change this, an access specification of the form <code class="docutils literal notranslate"><span class="pre">public:</span></code> or <code class="docutils literal notranslate"><span class="pre">protected:</span></code></p>
</div>
<div class="section" id="data-type">
<h4>Data Type<a class="headerlink" href="#data-type" title="Permalink to this headline">¶</a></h4>
<p>Cactus supports integer, real, complex and character variable types, in various different sizes. Normally a thorn should use the default types (<strong>CCTK_INT</strong>, <strong>CCTK_REAL</strong>, <strong>CCTK_COMPLEX</strong>) rather than explicitly setting the size, as this gives maximum portability.</p>
</div>
<div class="section" id="vector-group">
<h4>Vector Group<a class="headerlink" href="#vector-group" title="Permalink to this headline">¶</a></h4>
<p>If [number] present, indicates that this is a vector group.</p>
</div>
<div class="section" id="group-types">
<h4>Group Types<a class="headerlink" href="#group-types" title="Permalink to this headline">¶</a></h4>
<p>Groups can be either scalars, grid functions (GFs), or grid arrays.</p>
<ul class="simple">
<li><p><strong>SCALAR</strong>: This is just a single number.</p></li>
<li><p><strong>GF</strong>: This is the most common group type. A GF is an array with a specific size, set at run time in the parameter file, which is distributed across processors. All GFs have the same size, and the same number of ghostzones. Groups of GFs can also specify a dimension, and number of timelevels.</p></li>
<li><p><strong>ARRAY</strong>: This is a more general form of the GF. Each group of arrays can have a distinct size and number of ghostzones, in addition to dimension and number of timelevels. The drawback of using an array over a GF is that a lot of data about the array can only be determined by function calls, rather than the quicker methods available for GFs.</p></li>
</ul>
</div>
<div class="section" id="dim">
<h4>DIM<a class="headerlink" href="#dim" title="Permalink to this headline">¶</a></h4>
<p>DIM defines the spatial dimension of the ARRAY or GF. The default value is <code class="docutils literal notranslate"><span class="pre">DIM=3</span></code>.</p>
</div>
<div class="section" id="timelevels">
<h4>Timelevels<a class="headerlink" href="#timelevels" title="Permalink to this headline">¶</a></h4>
<p>TIMELEVELS defines the number of timelevels a group has if the group is of type ARRAY or GF, and can take any positive value. The default is one timelevel.</p>
</div>
<div class="section" id="size-and-distrib">
<h4>Size and Distrib<a class="headerlink" href="#size-and-distrib" title="Permalink to this headline">¶</a></h4>
<p>A Cactus grid function or array has a size set at runtime by parameters. This size can either be the global size of the array across all processors (<code class="docutils literal notranslate"><span class="pre">DISTRIB=DEFAULT</span></code>), or, if <code class="docutils literal notranslate"><span class="pre">DISTRIB=CONSTANT</span></code>, the specified size on each processor. If the size is split across processors, the driver thorn is responsible for assigning the size on each processor.</p>
</div>
<div class="section" id="ghost-zones">
<h4>Ghost Zones<a class="headerlink" href="#ghost-zones" title="Permalink to this headline">¶</a></h4>
<p>Cactus is based upon a distributed computing paradigm. That is, the problem domain is split into blocks, each of which is assigned to a processor. For hyperbolic and parabolic problems the blocks only need to communicate at the edges. It defaults to zero.</p>
</div>
<div class="section" id="tags">
<h4>TAGS<a class="headerlink" href="#tags" title="Permalink to this headline">¶</a></h4>
<p>TAGS defines an optional string which is used to create a set of key-value pairs associated with the group. The keys are case independent. The string (which must be deliminated by single or double quotes) is interpreted by the function <code class="docutils literal notranslate"><span class="pre">Util_TableSetFromString()</span></code>.</p>
</div>
</div>
<div class="section" id="function">
<h3>Function<a class="headerlink" href="#function" title="Permalink to this headline">¶</a></h3>
<p>Cactus offers a mechanism for calling a function in a different thorn where you don’t need to know which thorn is actually providing the function, nor what language the function is provided in. Function aliasing is also comparatively inefficient, and should not be used in a part of your code where efficiency is important.</p>
<p>If any aliased function is to be used or provided by the thorn, then the prototype must be declared with the form:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">return_type</span><span class="o">&gt;</span> <span class="n">FUNCTION</span> <span class="o">&lt;</span><span class="n">alias</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">arg1_type</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">intent1</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">&lt;return_type&gt;</span></code> must be either void, CCTK_INT, CCTK_REAL, CCTK_COMPLEX, CCTK_POINTER, or CCTK_POINTER_TO_CONST. Standard types such as int are not allowed. The keyword <code class="docutils literal notranslate"><span class="pre">SUBROUTINE</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">FUNCTION</span></code>.</p></li>
<li><p>The name of the aliased function <code class="docutils literal notranslate"><span class="pre">&lt;alias&gt;</span></code> must contain at least one uppercase and one lowercase letter and follow the C standard for function names.</p></li>
<li><p>The type of an argument, <code class="docutils literal notranslate"><span class="pre">&lt;arg*_type&gt;</span></code>, must be one of scalar types CCTK_INT, CCTK_REAL, CCTK_COMPLEX, CCTK_POINTER, CCTK_POINTER_TO_CONST, or an array or pointer type CCTK_INT ARRAY, CCTK_REAL ARRAY, CCTK_COMPLEX ARRAY, CCTK_POINTER ARRAY. The scalar types are assumed to be not modifiable. If you wish to modify an argument, then it must have intent OUT or INOUT (and hence must be either a CCTK_INT, a CCTK_REAL, or a CCTK_COMPLEX, or an array of one of these types).</p></li>
<li><p>The intent of each argument, <code class="docutils literal notranslate"><span class="pre">&lt;intent*&gt;</span></code>, must be either IN, OUT, or INOUT. The C prototype will expect an argument with intent IN to be a value and one with intent OUT or INOUT to be a pointer.</p></li>
<li><p>CCTK_STRING must appear at the end of the argument list.</p></li>
</ul>
<div class="section" id="using-an-aliased-function">
<h4>Using an Aliased Function<a class="headerlink" href="#using-an-aliased-function" title="Permalink to this headline">¶</a></h4>
<p>To use an aliased function you must first declare it in your <code class="docutils literal notranslate"><span class="pre">interface.ccl</span></code> file. Declare the prototype as, for example,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* this function will be either required in your thorn by */</span>
<span class="n">REQUIRES</span> <span class="n">FUNCTION</span> <span class="o">&lt;</span><span class="n">alias</span><span class="o">&gt;</span>
<span class="cm">/* or optionally used in your thorn by */</span>
<span class="n">USES</span> <span class="n">FUNCTION</span> <span class="o">&lt;</span><span class="n">alias</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>A prototype of this function will be available to any C routine that includes the <code class="docutils literal notranslate"><span class="pre">cctk.h</span></code> header file.</p>
</div>
<div class="section" id="providing-a-function">
<h4>Providing a Function<a class="headerlink" href="#providing-a-function" title="Permalink to this headline">¶</a></h4>
<p>To provide an aliased function you must again add the prototype to your <code class="docutils literal notranslate"><span class="pre">interface.ccl</span></code> file. A statement containing the name of the providing function and the language it is provided in, must also be given. For example,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PROVIDES</span> <span class="n">FUNCTION</span> <span class="o">&lt;</span><span class="n">alias</span><span class="o">&gt;</span> <span class="n">WITH</span> <span class="o">&lt;</span><span class="n">provider</span><span class="o">&gt;</span> <span class="n">LANGUAGE</span> <span class="o">&lt;</span><span class="n">providing_language</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>As with the alias name, <code class="docutils literal notranslate"><span class="pre">&lt;provider&gt;</span></code> must contain at least one uppercase and one lowercase letter, and follow the C standard for function names. It is necessary to specify the language of the providing function; no default will be assumed. Currently, the only supported values of <code class="docutils literal notranslate"><span class="pre">&lt;providing_language&gt;</span></code> are C and Fortran.</p>
</div>
<div class="section" id="testing-aliased-functions">
<h4>Testing Aliased Functions<a class="headerlink" href="#testing-aliased-functions" title="Permalink to this headline">¶</a></h4>
<p>The calling thorn does not know if an aliased function is even provided by another thorn. Calling an aliased function that has not been provided, will lead to a level 0 warning message, stopping the code. In order to check if a function has been provided by some thorn, use the <code class="docutils literal notranslate"><span class="pre">CCTK_IsFunctionAliased</span></code> function described in the function reference section.</p>
</div>
</div>
</div>
<div class="section" id="the-param-ccl-file">
<h2>The param.ccl File<a class="headerlink" href="#the-param-ccl-file" title="Permalink to this headline">¶</a></h2>
<p>Parameters are the means by which the user specifies the runtime behaviour of the code. Each parameter has a data type and a name, as well as a range of allowed values and a default value. These are declared in the thorn’s <cite>param.ccl</cite> file.</p>
<p>The full specification for a parameter declaration is</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">access</span><span class="o">&gt;:</span><span class="p">]</span>

<span class="p">[</span><span class="n">EXTENDS</span><span class="o">|</span><span class="n">USES</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">parameter_type</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">parameter</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">[[</span><span class="o">&lt;</span><span class="n">len</span><span class="o">&gt;</span><span class="p">]]</span> <span class="s">&quot;&lt;parameter_description&gt;&quot;</span> <span class="p">[</span><span class="n">AS</span> <span class="o">&lt;</span><span class="n">alias</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">STEERABLE</span><span class="o">=&lt;</span><span class="n">NEVER</span><span class="o">|</span><span class="n">ALWAYS</span><span class="o">|</span><span class="n">RECOVER</span><span class="o">&gt;</span><span class="p">]</span>
<span class="p">{</span>
    <span class="o">&lt;</span><span class="n">PARAMETER_RANGES</span><span class="o">&gt;</span>
<span class="p">}</span> <span class="o">&lt;</span><span class="n">default_value</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The options AS, STEERABLE, etc., following &lt;parameter description&gt;, must all appear in one line.</p>
<div class="section" id="id1">
<h3>Access<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>There are three access levels available for parameters:</p>
<ul class="simple">
<li><p><strong>Global</strong>: These parameters are seen by all thorns.</p></li>
<li><p><strong>Restricted</strong>: These parameters may be used by other implementations if they so desire.</p></li>
<li><p><strong>Private</strong>: These are only seen by this thorn.</p></li>
</ul>
</div>
<div class="section" id="id2">
<h3>Inheritance relationships between thorns<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>To access <strong>restricted</strong> parameters from another implementation, a line containing</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">shares</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Each of these parameters must be qualified by the initial token <strong>USES</strong> or <strong>EXTENDS</strong>, where</p>
<ul class="simple">
<li><p><strong>USES</strong>: indicates that the parameters range remains unchanged.</p></li>
<li><p><strong>EXTENDS</strong>: indicates that the parameters range is going to be extended.</p></li>
</ul>
<p>For example, the following block adds possible values to the keyword &lt;par&gt; originally defined in the implementation &lt;name&gt;, and uses the REAL parameter &lt;par&gt;.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">shares</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>

<span class="n">EXTENDS</span> <span class="n">KEYWORD</span> <span class="o">&lt;</span><span class="n">par</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="s">&quot;KEYWORD&quot;</span>   <span class="o">::</span> <span class="s">&quot;A description of the parameter&quot;</span>
<span class="p">}</span>

<span class="n">USES</span> <span class="n">CCTK_REAL</span> <span class="o">&lt;</span><span class="n">par</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Note that you must compile at least one thorn which implements &lt;name&gt;.</p>
</div>
<div class="section" id="parameter-type">
<h3>parameter type<a class="headerlink" href="#parameter-type" title="Permalink to this headline">¶</a></h3>
<p>Parameters can be of these types:</p>
<ul>
<li><p><strong>CCTK_INT</strong>: Can take any integral value</p>
<blockquote>
<div><p>The range specification is of the form</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>INT &lt;par&gt; &quot;A description of the parameter&quot;
{
    \\ Each range may have a description associated with it by placing a ``::`` on the line, and putting the description afterwards.
    lower:upper:stride :: &quot;Describing the allowed values of the parameter. lower and upper specify the lower and upper allowed range, and stride allows numbers to be missed out. A missing end of range (or a `*`) indicates negative or positive infinity.&quot;
} &lt;default value&gt;
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><strong>CCTK_REAL</strong>: Can take any floating point value</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span>REAL &lt;par&gt; &quot;A description of the parameter&quot;
{
    \\ Each range may have a description associated with it by placing a ``::`` on the line, and putting the description afterwards.
    lower:upper :: &quot;Describing the allowed values of the parameter. lower and upper specify the lower and upper allowed range. A missing end of range (or a `*`) implies negative or positive infinity. &quot;
} &lt;default value&gt;
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>CCTK_KEYWORD: A distinct string with only a few known allowed values.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">KEYWORD</span> <span class="o">&lt;</span><span class="n">par</span><span class="o">&gt;</span> <span class="s">&quot;A description of the parameter&quot;</span>
<span class="p">{</span>
    <span class="s">&quot;KEYWORD_1&quot;</span>   <span class="o">::</span> <span class="s">&quot;A description of the parameter&quot;</span>
    <span class="s">&quot;KEYWORD_2&quot;</span>   <span class="o">::</span> <span class="s">&quot;A description of the parameter&quot;</span>
    <span class="s">&quot;KEYWORD_3&quot;</span>   <span class="o">::</span> <span class="s">&quot;A description of the parameter&quot;</span>
<span class="p">}</span> <span class="o">&lt;</span><span class="k">default</span> <span class="n">value</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>CCTK_STRING: An arbitrary string, which must conform to a given regular expression. To allow any string, the regular expression “” should be used. Regular expressions and string values should be enclosed in double quotes.</p></li>
<li><p>CCTK_BOOLEAN: A boolean type which can take values 1, t, true, yes or 0, f, false, no.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">BOOLEAN</span> <span class="o">&lt;</span><span class="n">par</span><span class="o">&gt;</span> <span class="s">&quot;A description of the parameter&quot;</span>
<span class="p">{</span>
<span class="p">}</span> <span class="o">&lt;</span><span class="k">default</span> <span class="n">value</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="name">
<h3>Name<a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h3>
<p>The &lt;parameter name&gt; must be unique within the scope of the thorn. &lt;len&gt; indicates that this is an array parameter of len values of the specified type. &lt;alias&gt; allows a parameter to appear under a different name in this thorn, other than its original name in another thorn.</p>
</div>
<div class="section" id="steerable">
<h3>Steerable<a class="headerlink" href="#steerable" title="Permalink to this headline">¶</a></h3>
<p>By default, parameters may not be changed after the parameter file has been read, or on restarting from checkpoint. A parameter can be changed dynamically if it is specified to be steerable. It can then be changed by a call to the flesh function <code class="docutils literal notranslate"><span class="pre">CCTK_ParameterSet</span></code>.</p>
<p>The value RECOVERY is used in checkpoint/recovery situations, and indicates that the parameter may be altered until the value is read in from a recovery par file, but not after.</p>
</div>
</div>
<div class="section" id="the-schedule-ccl-file">
<h2>The schedule.ccl File<a class="headerlink" href="#the-schedule-ccl-file" title="Permalink to this headline">¶</a></h2>
<p>A schedule configuration file consists of:</p>
<ul class="simple">
<li><p>Assignment statements to switch on storage for grid variables for the entire duration of program execution.</p></li>
<li><p>Schedule blocks to schedule a subroutine from a thorn to be called at specific times during program execution in a given manner.</p></li>
<li><p>Conditional statements for both assignment statements and schedule blocks to allow them to be processed depending on parameter values.</p></li>
</ul>
<div class="section" id="assignment-statements">
<h3>Assignment Statements<a class="headerlink" href="#assignment-statements" title="Permalink to this headline">¶</a></h3>
<p>Assignment statements, currently only assign storage.</p>
<p>These lines have the form:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">STORAGE</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">group</span><span class="o">&gt;</span><span class="p">[</span><span class="n">timelevels</span><span class="p">]</span>
</pre></div>
</div>
<p>If the thorn is active, storage will be allocated, for the given groups, for the duration of program execution (unless storage is explicitly switched off by some call to <code class="docutils literal notranslate"><span class="pre">CCTK_DisableGroupStorage</span></code> within a thorn).</p>
<p>The storage line includes the number of timelevels to activate storage for, this number can be from 1 up to the maximum number or timelevels for the group, as specified in the defining <em>interface.ccl</em> file. Alternatively timelevels can be the name of a parameter accessible to the thorn. The parameter name is the same as used in C routines of the thorn, fully qualified parameter names of the form <code class="docutils literal notranslate"><span class="pre">thorn::parameter</span></code> are not allowed.</p>
<p>The behaviour of an assignment statement is independent of its position in the schedule file (so long as it is outside a schedule block).</p>
</div>
<div class="section" id="schedule-blocks">
<h3>Schedule Blocks<a class="headerlink" href="#schedule-blocks" title="Permalink to this headline">¶</a></h3>
<p>The flesh knows about everything in <em>schedule.ccl</em> files, and handles sorting scheduled routines into an order. Each schedule block in the file schedule.ccl must have the syntax</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">schedule</span> <span class="p">[</span><span class="n">GROUP</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">function</span><span class="o">|</span><span class="n">schedule</span> <span class="n">group</span> <span class="n">name</span><span class="o">&gt;</span> <span class="n">AT</span><span class="o">|</span><span class="n">IN</span> <span class="o">&lt;</span><span class="n">schedule</span> <span class="n">bin</span><span class="o">|</span><span class="n">group</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">AS</span> <span class="o">&lt;</span><span class="n">alias</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">WHILE</span> <span class="o">&lt;</span><span class="n">variable</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">IF</span> <span class="o">&lt;</span><span class="n">variable</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">BEFORE</span><span class="o">|</span><span class="n">AFTER</span> <span class="o">&lt;</span><span class="n">item</span><span class="o">&gt;|</span><span class="p">(</span><span class="o">&lt;</span><span class="n">item</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">item</span><span class="o">&gt;</span> <span class="p">...)]</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nl">LANG</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">FORTRAN</span><span class="o">|</span><span class="n">C</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="nl">STORAGE</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">group</span><span class="o">&gt;</span><span class="p">[</span><span class="n">timelevels</span><span class="p">]]</span>
    <span class="p">[</span><span class="nl">TRIGGERS</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">group</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="nl">SYNC</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">group</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="nl">OPTIONS</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">option</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="nl">TAGS</span><span class="p">:</span> <span class="p">[</span><span class="n">list</span> <span class="n">of</span> <span class="n">keyword</span><span class="o">=</span><span class="n">value</span> <span class="n">definitions</span><span class="p">]]</span>
    <span class="p">[</span><span class="nl">READS</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">group</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="nl">WRITES</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">group</span><span class="o">&gt;</span><span class="p">]</span>
<span class="p">}</span> <span class="s">&quot;A description&quot;</span>
</pre></div>
</div>
<div class="section" id="schedule-bins">
<h4>Schedule Bins<a class="headerlink" href="#schedule-bins" title="Permalink to this headline">¶</a></h4>
<p>Each schedule item is scheduled either AT a particular scheduling bin, or IN a schedule group. A list of the most useful schedule bins for application thorns is given here.</p>
<div class="figure align-default">
<img alt="../../_images/Schedule_Bin.png" src="../../_images/Schedule_Bin.png" />
</div>
<p>In the absence of any ordering, functions in a particular schedule bin will be called in an undetermined order.</p>
</div>
<div class="section" id="group">
<h4>Group<a class="headerlink" href="#group" title="Permalink to this headline">¶</a></h4>
<p>If the optional GROUP specifier is used, the item is a schedule group rather than a normal function. Schedule groups are effectively new, user-defined, schedule bins. Functions or groups may be scheduled IN these, in the same way as they are scheduled AT the main schedule bins.</p>
</div>
<div class="section" id="schedule-options">
<h4>Schedule Options<a class="headerlink" href="#schedule-options" title="Permalink to this headline">¶</a></h4>
<p>The options define various characteristics of the schedule item.</p>
<ul>
<li><p><strong>AS</strong>: This assigns a new name to a function for scheduling purposes.</p></li>
<li><p><strong>WHILE</strong>: This specifies a CCTK_INT grid scalar which is used to control the execution of this item. As long as the grid scalar has a nonzero value, the schedule item will be executed repeatedly.</p></li>
<li><p><strong>IF</strong>: This specifies a CCTK_INT grid scalar which is used to control the execution of this item. If the grid scalar has a nonzero value, the schedule item will be executed, otherwise the item will be ignored. If both an IF and a WHILE clause are present, then the schedule is executed according to the following pseudocode:</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">IF</span> <span class="n">condition</span>
    <span class="n">WHILE</span> <span class="n">condition</span>
        <span class="n">SCHEDULE</span> <span class="n">item</span>
    <span class="n">END</span> <span class="n">WHILE</span>
<span class="n">END</span> <span class="n">IF</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><strong>BEFORE</strong> or <strong>AFTER</strong>: These specify either a function or group before or after which this item will be scheduled.</p></li>
</ul>
</div>
<div class="section" id="further-details">
<h4>Further details<a class="headerlink" href="#further-details" title="Permalink to this headline">¶</a></h4>
<p>The schedule block specifies further details of the scheduled function or group.</p>
<ul class="simple">
<li><p><strong>LANG</strong>: This specifies the language of the routine. Currently this is either C or Fortran.</p></li>
<li><p><strong>STORAGE</strong>: The STORAGE keyword specifies groups for which memory should be allocated for the duration of the routine or schedule group. The storage status reverts to its previous status after completion of the routine or schedule group.</p></li>
<li><p><strong>TRIGGER</strong>: List of grid variables or groups to be used as triggers for causing an ANALYSIS function or group to be executed.</p></li>
<li><p><strong>SYNC</strong>: The keyword SYNC specifies groups of variables which should be synchronised (that is, their ghostzones should be exchanged between processors) on exit from the routine.</p></li>
<li><p><strong>OPTIONS</strong>: Often used schedule options are local (also the default), level, or global. These options are interpreted by the driver, not by Cactus. The current set of options is useful for Berger-Oliger mesh refinement which has subcycling in time, and for multi-patch simulations in which the domain is split into several distinct patches. Routines scheduled in local mode can access individual grid points, routines scheduled in level mode are used e.g. to select boundary conditions, and routines schedule in global mode are e.g. used to calculate reductions (norms).</p></li>
<li><p><strong>TAGS</strong>: Schedule tags. These tags must have the form keyword=value, and must be in a syntax accepted by <code class="docutils literal notranslate"><span class="pre">Util_TableCreateFromString</span></code>.</p></li>
<li><p><strong>READS</strong>: READS is used to declare which grid variables are read by the routine.</p></li>
<li><p><strong>WRITES</strong>: WRITES is used to declare which grid variables are written by the routine.</p></li>
</ul>
</div>
</div>
<div class="section" id="conditional-statements">
<h3>Conditional Statements<a class="headerlink" href="#conditional-statements" title="Permalink to this headline">¶</a></h3>
<p>Besides schedule blocks, it’s possible to embed C style if/else statements in the schedule.ccl file. These can be used to schedule things based upon the value of a parameter.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">conditional</span><span class="o">-</span><span class="n">expression</span><span class="o">&gt;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">[</span><span class="o">&lt;</span><span class="n">assignments</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">[</span><span class="o">&lt;</span><span class="n">schedule</span> <span class="n">blocks</span><span class="o">&gt;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>&lt;conditional-expression&gt; can be any valid C construct evaluating to a truth value. Such conditionals are evaluated only at program startup, and are used to pick between different static schedule options.</p>
</div>
</div>
<div class="section" id="the-source-file">
<h2>The Source File<a class="headerlink" href="#the-source-file" title="Permalink to this headline">¶</a></h2>
<div class="section" id="compile">
<h3>Compile<a class="headerlink" href="#compile" title="Permalink to this headline">¶</a></h3>
<p>By default, the CCTK looks in the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory of the thorn for source files.</p>
<p>The Cactus make system looks for a file called <code class="docutils literal notranslate"><span class="pre">make.code.defn</span></code> in that directory (if there is no file called <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> in the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory). At its simplest, this file contains two lines</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SRCS</span> <span class="o">=</span> &lt;list of all <span class="nb">source</span> files in this directory&gt;
<span class="nv">SUBDIRS</span> <span class="o">=</span> &lt;list of all subdirectories, including subdirectories of subdirectories&gt;
</pre></div>
</div>
<p>Each subdirectory listed should then have a <code class="docutils literal notranslate"><span class="pre">make.code.defn</span></code> file containing just a <code class="docutils literal notranslate"><span class="pre">SRCS</span> <span class="pre">=</span></code> line, a <code class="docutils literal notranslate"><span class="pre">SUBDIRS</span> <span class="pre">=</span></code> line will be ignored.</p>
<p>Then you need to build the code. The command you need to run is the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make &lt;name&gt;
</pre></div>
</div>
<p>Each configuration has a <em>ThornList</em> which lists the thorns to be compiled in. When this list changes, only those thorns directly affected by the change are recompiled.</p>
</div>
<div class="section" id="routines">
<h3>Routines<a class="headerlink" href="#routines" title="Permalink to this headline">¶</a></h3>
<p>Any source file using Cactus infrastructure should include the header file <code class="docutils literal notranslate"><span class="pre">cctk.h</span></code> using the line</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;cctk.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<p>Any routine using Cactus argument lists (for example, all routines called from the scheduler at time bins between CCTK_STARTUP and CCTK_SHUTDOWN) should include at the top of the file the header</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;cctk_Arguments.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<p>A Cactus macro CCTK_ARGUMENTS is defined for each thorn to contain:</p>
<ul class="simple">
<li><p>General information about the grid hierarchy.</p></li>
<li><p>All the grid variables defined in the thorn’s <em>interface.ccl</em>.</p></li>
<li><p>All the grid variables required from other thorns as requested by the <code class="docutils literal notranslate"><span class="pre">inherits</span></code> and <code class="docutils literal notranslate"><span class="pre">friend</span></code> lines in the <em>interface.ccl</em>.</p></li>
</ul>
<p>These variables must be declared at the start of the routine using the macro DECLARE_CCTK_ARGUMENTS.</p>
<p>Any routine using Cactus parameters should include at the top of the file the header</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;cctk_Parameters.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<p>All parameters defined in a thorn’s <em>param.ccl</em>. Booleans and Integers appear as CCTK_INT types (with nonzero/zero values for boolean yes/no), Reals as CCTK_REAL, and Keywords and String parameters as CCTK_STRING. These variables are read only, and changes should not be made to them. The effect of changing a parameter is undefined (at best). To compare a string valued parameter use the function <code class="docutils literal notranslate"><span class="pre">CCTK_Equals()</span></code>.</p>
<p>The parameters should be declared at the start of the routine using them with the macro DECLARE_CCTK_PARAMETERS.</p>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>The C routine MyCRoutine is scheduled in the schedule.ccl file, and uses Cactus parameters. The source file should look like</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;cctk.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cctk_Arguments.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cctk_Parameters.h&quot;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">MyFunction</span><span class="p">(</span><span class="n">CCTK_ARGUMENTS</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DECLARE_CCTK_ARGUMENTS</span>
    <span class="n">DECLARE_CCTK_PARAMETERS</span>

    <span class="cm">/* Here goes your code */</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The C++ routine MyCRoutine is scheduled in the schedule.ccl file, and uses Cactus parameters. The source file should look like</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;cctk.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cctk_Arguments.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cctk_Parameters.h&quot;</span><span class="cp"></span>

<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="kt">void</span> <span class="n">MyFunction</span><span class="p">(</span><span class="n">CCTK_ARGUMENTS</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DECLARE_CCTK_ARGUMENTS</span>
    <span class="n">DECLARE_CCTK_PARAMETERS</span>

    <span class="cm">/* Here goes your code */</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The Fortran routine MyCRoutine is scheduled in the schedule.ccl file, and uses Cactus parameters. The source file should look like</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;cctk.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cctk_Arguments.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cctk_Parameters.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cctk_Functions.h&quot;</span><span class="cp"></span>

<span class="n">subroutine</span> <span class="n">MyFunction</span><span class="p">(</span><span class="n">CCTK_ARGUMENTS</span><span class="p">)</span>

    <span class="n">implicit</span> <span class="n">none</span>

    <span class="n">DECLARE_CCTK_ARGUMENTS</span>
    <span class="n">DECLARE_CCTK_PARAMETERS</span>
    <span class="n">DECLARE_CCTK_FUNCTIONS</span>

    <span class="cm">/* Here goes your code */</span>
<span class="n">end</span>
</pre></div>
</div>
</div>
<div class="section" id="specifically-for-c-programmers">
<h4>Specifically for C Programmers<a class="headerlink" href="#specifically-for-c-programmers" title="Permalink to this headline">¶</a></h4>
<p>Grid functions are held in memory as 1-dimensional C arrays. Cactus provides macros to find the 1-dimensional index which is needed from the multidimensional indices which are usually used. There is a macro for each dimension of grid function. Below is an artificial example to demonstrate this using the 3D macro <code class="docutils literal notranslate"><span class="pre">CCTK_GFINDEX3D</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">cctk_lsh</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">cctk_lsh</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">cctk_lsh</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="k">const</span> <span class="n">ind3d</span> <span class="o">=</span> <span class="n">CCTK_GFINDEX3D</span><span class="p">(</span><span class="n">cctkGH</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">);</span>
            <span class="n">rho</span><span class="p">[</span><span class="n">ind3d</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">pow</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">ind3d</span><span class="p">],</span><span class="mi">2</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">CCTK_GFINDEX3D(cctkGH,i,j,k)</span></code> expands to <code class="docutils literal notranslate"><span class="pre">((i)</span> <span class="pre">+</span> <span class="pre">cctkGH-&gt;cctk_lsh[0]*((j)+cctkGH-&gt;cctk_lsh[1]*(k)))</span></code>. In Fortran, grid functions are accessed as Fortran arrays, i.e. simply as <code class="docutils literal notranslate"><span class="pre">rho(i,j,k)</span></code>.</p>
<p>To access vector grid functions, one also needs to specify the vector index. This is best done via the 3D macro <code class="docutils literal notranslate"><span class="pre">CCTK_VECTGFINDEX3D</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">cctk_lsh</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">cctk_lsh</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">cctk_lsh</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/* vector indices are 0, 1, 2 */</span>
            <span class="n">vel</span><span class="p">[</span><span class="n">CCTK_VECTGFINDEX3D</span><span class="p">(</span><span class="n">cctkGH</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
            <span class="n">vel</span><span class="p">[</span><span class="n">CCTK_VECTGFINDEX3D</span><span class="p">(</span><span class="n">cctkGH</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
            <span class="n">vel</span><span class="p">[</span><span class="n">CCTK_VECTGFINDEX3D</span><span class="p">(</span><span class="n">cctkGH</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="cactus-variables">
<h4>Cactus Variables<a class="headerlink" href="#cactus-variables" title="Permalink to this headline">¶</a></h4>
<p>The Cactus variables which are passed through the macro <code class="docutils literal notranslate"><span class="pre">CCTK_ARGUMENTS</span></code> are</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 7%" />
<col style="width: 93%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variables</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cctkGH</p></td>
<td><p>A C pointer identifying the grid hierarchy.</p></td>
</tr>
<tr class="row-odd"><td><p>cctk_dim</p></td>
<td><p>An integer with the number of dimensions used for this grid hierarchy.</p></td>
</tr>
<tr class="row-even"><td><p>cctk_lsh</p></td>
<td><p>An array of cctk_dim integers with the local grid size on this processor.</p></td>
</tr>
<tr class="row-odd"><td><p>cctk_ash</p></td>
<td><p>An array of cctk_dim integers with the allocated size of the array.</p></td>
</tr>
<tr class="row-even"><td><p>cctk_gsh</p></td>
<td><p>An array of cctk_dim integers with the global grid size.</p></td>
</tr>
<tr class="row-odd"><td><p>cctk_iteration</p></td>
<td><p>The current iteration number.</p></td>
</tr>
<tr class="row-even"><td><p>cctk_delta_time</p></td>
<td><p>A CCTK_REAL with the timestep.</p></td>
</tr>
<tr class="row-odd"><td><p>cctk_time</p></td>
<td><p>A CCTK_REAL with the current time.</p></td>
</tr>
<tr class="row-even"><td><p>cctk_delta_space</p></td>
<td><p>An array of cctk_dim CCTK_REALs with the grid spacing in each direction.</p></td>
</tr>
<tr class="row-odd"><td><p>cctk_nghostzones</p></td>
<td><p>An array of cctk_dim integers with the number of ghostzones used in each direction.</p></td>
</tr>
<tr class="row-even"><td><p>cctk_origin_space</p></td>
<td><p>An array of cctk_dim CCTK_REALs with the spatial coordinates of the global origin of the grid.</p></td>
</tr>
<tr class="row-odd"><td><p>cctk_lbnd</p></td>
<td><p>An array of cctk_dim integers containing the lowest index (in each direction) of the local grid, as seen on the global grid.</p></td>
</tr>
<tr class="row-even"><td><p>cctk_ubnd</p></td>
<td><p>An array of cctk_dim integers containing the largest index (in each direction) of the local grid, as seen on the global grid.</p></td>
</tr>
<tr class="row-odd"><td><p>cctk_bbox</p></td>
<td><p>An array of 2*cctk_dim integers, which indicate whether the boundaries are internal boundaries (e.g. between processors), or physical boundaries. A value of 1 indicates a physical (outer) boundary at the edge of the computational grid, and 0 indicates an internal boundary.</p></td>
</tr>
<tr class="row-even"><td><p>cctk_levfac</p></td>
<td><p>An array of cctk_dim integer factors by which the local grid is refined in the corresponding direction with respect to the base grid.</p></td>
</tr>
<tr class="row-odd"><td><p>cctk_levoff</p></td>
<td><p>Two arrays of cctk_dim integers describing the distance by which the local grid is offset with respect to the base grid, measured in local grid spacings.</p></td>
</tr>
<tr class="row-even"><td><p>cctk_timefac</p></td>
<td><p>The integer factor by which the time step size is reduced with respect to the base grid.</p></td>
</tr>
<tr class="row-odd"><td><p>cctk_convlevel</p></td>
<td><p>The convergence level of this grid hierarchy. The base level is 0, and every level above that is coarsened by a factor of cctk_convfac.</p></td>
</tr>
<tr class="row-even"><td><p>cctk_convfac</p></td>
<td><p>The factor between convergence levels. The relation between the resolutions of different convergence levels is <span class="math notranslate nohighlight">\(\Delta x_{L}=\Delta x_{0} \cdot F^{L}\)</span>, where L is the convergence level and F is the convergence factor. The convergence factor defaults to 2.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="cctk-routines">
<h3>CCTK Routines<a class="headerlink" href="#cctk-routines" title="Permalink to this headline">¶</a></h3>
<div class="section" id="providing-runtime-information">
<h4>Providing Runtime Information<a class="headerlink" href="#providing-runtime-information" title="Permalink to this headline">¶</a></h4>
<p>To write from thorns to standard output (i.e. the screen) at runtime, use the macro <code class="docutils literal notranslate"><span class="pre">CCTK_INFO</span></code>. For example,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">CCTK_INFO</span><span class="p">(</span><span class="s">&quot;Hellow World&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>will write the line:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span> <span class="p">(</span><span class="n">MyThorn</span><span class="p">)</span><span class="o">:</span> <span class="n">Hellow</span> <span class="n">World</span>
</pre></div>
</div>
<p>Including variables in the info message use <code class="docutils literal notranslate"><span class="pre">CCTK_VINFO</span></code>. For example,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">CCTK_VINFO</span><span class="p">(</span><span class="s">&quot;The integer is %d&quot;</span><span class="p">,</span> <span class="n">myint</span><span class="p">);</span>
</pre></div>
</div>
<p>For a multiprocessor run, only runtime information from processor zero will be printed to screen by default.</p>
</div>
<div class="section" id="error-handling-warnings-and-code-termination">
<h4>Error Handling, Warnings and Code Termination<a class="headerlink" href="#error-handling-warnings-and-code-termination" title="Permalink to this headline">¶</a></h4>
<p>The Cactus macros <code class="docutils literal notranslate"><span class="pre">CCTK_ERROR</span></code> and <code class="docutils literal notranslate"><span class="pre">CCTK_VERROR</span></code> should be used to output error messages and abort the code. The Cactus macros <code class="docutils literal notranslate"><span class="pre">CCTK_WARN</span></code> and <code class="docutils literal notranslate"><span class="pre">CCTK_VWARN</span></code> should be used to issue warning messages during code execution.</p>
<p>Along with the warning message, an integer is given to indicate the severity of the warning.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 4%" />
<col style="width: 82%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Macros</p></th>
<th class="head"><p>Level</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CCTK_WARN_ABORT</p></td>
<td><p>0</p></td>
<td><p>abort the Cactus run</p></td>
</tr>
<tr class="row-odd"><td><p>CCTK_WARN_ALERT</p></td>
<td><p>1</p></td>
<td><p>the results of this run will be wrong,</p></td>
</tr>
<tr class="row-even"><td><p>CCTK_WARN_COMPLAIN</p></td>
<td><p>2</p></td>
<td><p>the user should know about this, but the problem is not terribly surprising</p></td>
</tr>
<tr class="row-odd"><td><p>CCTK_WARN_PICKY</p></td>
<td><p>3</p></td>
<td><p>this is for small problems that can probably be ignored, but that careful people may want to know about</p></td>
</tr>
<tr class="row-even"><td><p>CCTK_WARN_DEBUG</p></td>
<td><p>4</p></td>
<td><p>these messages are probably useful only for debugging purposes</p></td>
</tr>
</tbody>
</table>
<p>A level 0 warning indicates the highest severity (and is guaranteed to abort the Cactus run), while larger numbers indicate less severe warnings. For example,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">CCTK_WARN</span><span class="p">(</span><span class="n">CCTK_WARN_ALERT</span><span class="p">,</span> <span class="s">&quot;Your warning message&quot;</span><span class="p">);</span>
<span class="n">CCTK_ERROR</span><span class="p">(</span><span class="s">&quot;Your error message&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that if the flesh parameter <code class="docutils literal notranslate"><span class="pre">cctk_full_warnings</span></code> is set to true, then <code class="docutils literal notranslate"><span class="pre">CCTK_ERROR</span></code> and <code class="docutils literal notranslate"><span class="pre">CCTK_WARN</span></code> automatically include the thorn name, the source code file name and line number in the message. The default is to omit the source file name and line number.</p>
<p>Including variables in the warning message use <code class="docutils literal notranslate"><span class="pre">CCTK_VERROR</span></code> and <code class="docutils literal notranslate"><span class="pre">CCTK_VWARN</span></code>. For example,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">CCTK_VWARN</span><span class="p">(</span><span class="n">CCTK_WARN_ALERT</span><span class="p">,</span> <span class="s">&quot;Your warning message, including %f and %d&quot;</span><span class="p">,</span> <span class="n">myreal</span><span class="p">,</span> <span class="n">myint</span><span class="p">);</span>
<span class="n">CCTK_ERROR</span><span class="p">(</span><span class="s">&quot;Your warning message, including %f and %d&quot;</span><span class="p">,</span> <span class="n">myreal</span><span class="p">,</span> <span class="n">myint</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="paramcheck">
<h4>ParamCheck<a class="headerlink" href="#paramcheck" title="Permalink to this headline">¶</a></h4>
<p>In your <em>schedule.ccl</em> file.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">SCHEDULE</span> <span class="n">MyCRoutine_ParamCheck</span> <span class="n">AT</span> <span class="n">CCTK_PARAMCHECK</span>
<span class="p">{</span>
    <span class="nl">LANG</span><span class="p">:</span> <span class="n">C</span>
<span class="p">}</span> <span class="s">&quot;ParamCheck&quot;</span>
</pre></div>
</div>
<p>In your code.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;cctk.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cctk_Arguments.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cctk_Parameters.h&quot;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">MyCRoutine_ParamCheck</span><span class="p">(</span><span class="n">CCTK_ARGUMENTS</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DECLARE_CCTK_ARGUMENTS</span><span class="p">;</span>
    <span class="n">DECLARE_CCTK_PARAMETERS</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="n">CCTK_EQUALS</span><span class="p">(</span><span class="n">metric_type</span><span class="p">,</span> <span class="s">&quot;physical&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
       <span class="o">!</span> <span class="n">CCTK_EQUALS</span><span class="p">(</span><span class="n">metric_type</span><span class="p">,</span> <span class="s">&quot;static conformal&quot;</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">CCTK_PARAMWARN</span><span class="p">(</span><span class="s">&quot;Unknown ADMBase::metric_type - known types are </span><span class="se">\&quot;</span><span class="s">physical</span><span class="se">\&quot;</span><span class="s"> and </span><span class="se">\&quot;</span><span class="s">static conformal</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="iterating-over-grid-points">
<h4>Iterating Over Grid Points<a class="headerlink" href="#iterating-over-grid-points" title="Permalink to this headline">¶</a></h4>
<p>A grid function consists of a multi-dimensional array of grid points. These grid points fall into several types:</p>
<ul class="simple">
<li><p><strong>interior</strong>: regular grid point, presumably evolved in time</p></li>
<li><p><strong>ghost</strong>: inter-process boundary, containing copies of values owned by another process</p></li>
<li><p><strong>physical boundary</strong>: outer boundary, presumably defined via a boundary condition</p></li>
<li><p><strong>symmetry boundary</strong>: defined via a symmetry, e.g. a reflection symmetry or periodicity</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Grid points in the edges and corners may combine several types. For example, a point in a corner may be a ghost point in the x direction, a physical boundary point in the y direction, and a symmetry point in the z direction.</p>
</div>
<p>The size of the physical boundary depends on the application. The number of ghost points is defined by the driver; the number of symmetry points is in principle defined by the thorn implementing the respective symmetry condition, but will in general be the same as the number of ghost points to avoid inconsistencies.</p>
<p>The flesh provides a set of macros to iterate over particular types of grid points.</p>
<ul>
<li><p>Loop over all grid points</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">CCTK_LOOP3_ALL</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cctkGH</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/* body of the loop */</span>
<span class="p">}</span> <span class="n">CCTK_ENDLOOP3_ALL</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Loop over all interior grid points</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">CCTK_LOOP3_INT</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cctkGH</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/* body of the loop */</span>
<span class="p">}</span> <span class="n">CCTK_ENDLOOP3_INT</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Loop over all physical boundary points</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">LOOP_BND</span></code> loops over all points that are physical boundaries (independent of whether they also are symmetry or ghost boundaries).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">CCTK_LOOP3_BND</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cctkGH</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span><span class="n">nj</span><span class="p">,</span><span class="n">nk</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/* body of the loop */</span>
<span class="p">}</span> <span class="n">CCTK_ENDLOOP3_BND</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Loop over all “interior” physical boundary point</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">LOOP_INTBND</span></code> loops over those points that are only physical boundaries (and excludes any points that belongs to a symmetry or ghost boundary).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">CCTK_LOOP3_INTBND</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cctkGH</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span><span class="n">nj</span><span class="p">,</span><span class="n">nk</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/* body of the loop */</span>
<span class="p">}</span> <span class="n">CCTK_ENDLOOP3_INTBND</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>In all cases, name should be replaced by a unique name for the loop. i, j, and k are names of variables that will be declared and defined by these macros, containing the index of the current grid point. Similarly ni, nj, and nk are names of variables describing the (outwards pointing) normal direction to the boundary as well as the distance to the boundary.</p>
</div>
<div class="section" id="interpolation-operators">
<h4>Interpolation Operators<a class="headerlink" href="#interpolation-operators" title="Permalink to this headline">¶</a></h4>
<p>There are two different flesh APIs for interpolation, depending on whether the data arrays are Cactus grid arrays or processor-local, programming language built-in arrays.</p>
<p><code class="docutils literal notranslate"><span class="pre">CCTK_InterpGridArrays()</span></code> function interpolates a list of CCTK grid variables (in a multiprocessor run these are generally distributed over processors) on a list of interpolation points. The grid topology and coordinates are implicitly specified via a Cactus coordinate system. The interpolation points may be anywhere in the global Cactus grid. Additional parameters for the interpolation operation can be passed in via a handle to a key-value options table.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;cctk.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;util_Table.h&quot;</span><span class="cp"></span>

<span class="cm">/* Pointer to a valid Cactus grid hierarchy. */</span>
<span class="k">const</span> <span class="n">cGH</span> <span class="o">*</span><span class="n">GH</span><span class="p">;</span>

<span class="cm">/* Number of dimensions in which to interpolate. */</span>
<span class="cp">#define N_DIMS 3</span>

<span class="cm">/* Handle to the local interpolation operator as returned by CCTK_InterpHandle. */</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">operator_handle</span> <span class="o">=</span> <span class="n">CCTK_InterpHandle</span><span class="p">(</span><span class="n">interpolator_name</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">operator_handle</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CCTK_VWARN</span><span class="p">(</span><span class="n">CCTK_WARN_ABORT</span><span class="p">,</span> <span class="s">&quot;Couldn&#39;t find interpolator </span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s">!&quot;</span><span class="p">,</span> <span class="n">interpolator_name</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Handle to a key-value table containing zero or more additional parameters for the interpolation operation. */</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">param_table_handle</span> <span class="o">=</span> <span class="n">Util_TableCreateFromString</span><span class="p">(</span><span class="n">interpolator_pars</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">param_table_handle</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CCTK_VWARN</span><span class="p">(</span><span class="n">CCTK_WARN_ABORT</span><span class="p">,</span> <span class="s">&quot;Bad interpolator parameter(s) </span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s">!&quot;</span><span class="p">,</span> <span class="n">interpolator_pars</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Handle to Cactus coordinate system as returned by CCTK_CoordSystemHandle. */</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">coord_system_handle</span> <span class="o">=</span> <span class="n">CCTK_CoordSystemHandle</span><span class="p">(</span><span class="n">coord_name</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">coord_system_handle</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CCTK_VWARN</span><span class="p">(</span><span class="n">CCTK_WARN_ABORT</span><span class="p">,</span> <span class="s">&quot;Couldn&#39;t get coordinate-system </span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s">!&quot;</span><span class="p">,</span> <span class="n">coord_name</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* The number of interpolation points requested by this processor. */</span>
<span class="cp">#define N_INTERP_POINTS 1000</span>

<span class="cm">/* (Pointer to) an array of N dims pointers to 1-D arrays giving the coordinates of the interpolation points requested by this processor. These coordinates are with respect to the coordinate system defined by coord system handle. */</span>
<span class="n">CCTK_REAL</span> <span class="n">interp_x</span><span class="p">[</span><span class="n">N_INTERP_POINTS</span><span class="p">],</span> <span class="n">interp_y</span><span class="p">[</span><span class="n">N_INTERP_POINTS</span><span class="p">],</span> <span class="n">interp_z</span><span class="p">[</span><span class="n">N_INTERP_POINTS</span><span class="p">];</span>
<span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">interp_coords</span><span class="p">[</span><span class="n">N_DIMS</span><span class="p">];</span>

<span class="n">interp_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="n">interp_x</span><span class="p">;</span>
<span class="n">interp_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="n">interp_y</span><span class="p">;</span>
<span class="n">interp_coords</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="n">interp_z</span><span class="p">;</span>

<span class="cm">/* The number of input variables to be interpolated. */</span>
<span class="cp">#define N_INPUT_ARRAYS 2</span>

<span class="cm">/* (Pointer to) an array of N_input_arrays CCTK grid variable indices (as returned by CCTK_VarIndex) specifying the input grid variables for the interpolation. */</span>
<span class="n">CCTK_INT</span> <span class="n">input_array_variable_indices</span><span class="p">[</span><span class="n">N_INPUT_ARRAYS</span><span class="p">];</span>
<span class="n">input_array_variable_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">CCTK_VarIndex</span><span class="p">(</span><span class="s">&quot;my_thorn::var1&quot;</span><span class="p">);</span>
<span class="n">input_array_variable_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">CCTK_VarIndex</span><span class="p">(</span><span class="s">&quot;my_thorn::var2&quot;</span><span class="p">);</span>

<span class="cm">/* The number of output arrays to be returned from the interpolation. Note that N_output_arrays may differ from N_input_arrays. */</span>
<span class="cp">#define N_OUTPUT_ARRAYS 2</span>

<span class="cm">/* Giving the data types of the 1-D output arrays pointed to by output_arrays[]. */</span>
<span class="n">CTK_INT</span> <span class="n">output_array_type_codes</span><span class="p">[</span><span class="n">N_OUTPUT_ARRAYS</span><span class="p">]</span>
<span class="n">output_array_type_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">CCTK_VARIABLE_REAL</span>
<span class="n">output_array_type_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">CCTK_VARIABLE_COMPLEX</span>

<span class="cm">/* (Pointer to) an array of N_output_arrays pointers to the (user-supplied) 1-D output arrays for the interpolation. */</span>
<span class="kt">void</span> <span class="o">*</span><span class="n">output_arrays</span><span class="p">[</span><span class="n">N_OUTPUT_ARRAYS</span><span class="p">];</span>
<span class="n">CCTK_REAL</span> <span class="n">output_for_real_array</span> <span class="p">[</span><span class="n">N_INTERP_POINTS</span><span class="p">];</span>
<span class="n">CCTK_COMPLEX</span> <span class="n">output_for_complex_array</span><span class="p">[</span><span class="n">N_INTERP_POINTS</span><span class="p">];</span>
<span class="n">output_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="n">output_for_real_array</span><span class="p">;</span>
<span class="n">output_arrays</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="n">output_for_complex_array</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">CCTK_InterpGridArrays</span><span class="p">(</span>
    <span class="n">GH</span><span class="p">,</span>
    <span class="n">N_DIMS</span><span class="p">,</span>
    <span class="n">operator_handle</span><span class="p">,</span>
    <span class="n">param_table_handle</span><span class="p">,</span>
    <span class="n">coord_system_handle</span><span class="p">,</span>
    <span class="n">N_INTERP_POINTS</span><span class="p">,</span>
    <span class="n">CCTK_VARIABLE_REAL</span><span class="p">,</span> <span class="c1">// Giving the data type of the interpolation-point coordinate arrays pointed to by interp_coords[].</span>
    <span class="n">interp_coords</span><span class="p">,</span>
    <span class="n">N_INPUT_ARRAYS</span><span class="p">,</span>
    <span class="n">input_array_variable_indices</span><span class="p">,</span>
    <span class="n">N_OUTPUT_ARRAYS</span><span class="p">,</span>
    <span class="n">output_array_type_codes</span><span class="p">,</span>
    <span class="n">output_arrays</span>
<span class="p">)</span>

<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CCTK_WARN</span><span class="p">(</span><span class="n">CCTK_WARN_ABORT</span><span class="p">,</span> <span class="s">&quot;error return from interpolator!&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CCTK_InterpLocalUniform()</span></code> interpolate a list of processor-local arrays which define a uniformly-spaced data grid.</p>
</div>
<div class="section" id="reduction-operators">
<h4>Reduction Operators<a class="headerlink" href="#reduction-operators" title="Permalink to this headline">¶</a></h4>
<p>A reduction operation can be defined as an operation on variables distributed across multiple processor resulting in a single number. Typical reduction operations are: sum, minimum/maximum value, and boolean operations. The different operators are identified by their name and/or a unique number, called a handle.</p>
<p>There are two different flesh APIs for reduction, depending on whether the data arrays are Cactus grid arrays or processor-local, programming language built-in arrays.</p>
<p><code class="docutils literal notranslate"><span class="pre">CCTK_ReduceGridArrays()</span></code> reduces a list of CCTK grid arrays (in a multiprocessor run these are generally distributed over processors).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;cctk.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;util_Table.h&quot;</span><span class="cp"></span>

<span class="cm">/* Pointer to a valid Cactus grid hierarchy. */</span>
<span class="k">const</span> <span class="n">cGH</span> <span class="o">*</span><span class="n">GH</span><span class="p">;</span>

<span class="cm">/* Handle to the local reduction operator as returned by CCTK_LocalArrayReductionHandle(). */</span>


<span class="k">const</span> <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">CCTK_ReduceGridArrays</span><span class="p">(</span>
    <span class="n">GH</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span> <span class="c1">// The destination processor</span>
    <span class="n">param_table_handle</span><span class="p">,</span>
    <span class="n">N_INPUT_ARRAYS</span><span class="p">,</span>
    <span class="n">input_array_variable_indices</span><span class="p">,</span>
    <span class="n">M_OUTPUT_VALUES</span><span class="p">,</span>
    <span class="n">output_value_type_codes</span><span class="p">,</span>
    <span class="n">output_values</span>
<span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CCTK_ReduceLocalArrays()</span></code> performs reduction on a list of local grid arrays.</p>
</div>
</div>
<div class="section" id="utility-routines">
<h3>Utility Routines<a class="headerlink" href="#utility-routines" title="Permalink to this headline">¶</a></h3>
<p>As well as the high-level <code class="docutils literal notranslate"><span class="pre">CCTK_*</span></code> routines, Cactus also provides a set of lower-level <code class="docutils literal notranslate"><span class="pre">Util_*</span></code> utility routines. Cactus functions may need to pass information through a generic interface. In the past, we often had trouble passing <code class="docutils literal notranslate"><span class="pre">extra''</span> <span class="pre">information</span> <span class="pre">that</span> <span class="pre">wasn't</span> <span class="pre">anticipated</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">original</span> <span class="pre">design.</span> <span class="pre">Key-value</span> <span class="pre">tables</span> <span class="pre">provide</span> <span class="pre">a</span> <span class="pre">clean</span> <span class="pre">solution</span> <span class="pre">to</span> <span class="pre">these</span> <span class="pre">problems.</span> <span class="pre">They're</span> <span class="pre">implemented</span> <span class="pre">by</span> <span class="pre">the</span> <span class="pre">``Util_Table*</span></code> functions.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Yu Liu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>