

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Install &mdash; Cactus 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Cactus
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="GetStart.html">Get Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="Thorn.html">Thorn Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="ThornWrite.html">Thorn Write</a></li>
<li class="toctree-l1"><a class="reference internal" href="Reference.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Cactus</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Install</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/note/install.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="install">
<h1>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://lists.einsteintoolkit.org/mailman/listinfo/users">Users</a> of the Einstein Toolkit are encouraged to <a class="reference external" href="http://einsteintoolkit.org/join.html">register</a> to become one of its.</p>
<div class="section" id="required-software">
<h2>Required Software<a class="headerlink" href="#required-software" title="Permalink to this headline">¶</a></h2>
<p>The main requirements are:</p>
<ul class="simple">
<li><p>Client tools for Source Code Repositories: CVS, SVN and git</p></li>
<li><p>Compilers: C, C++ and Fortran 90</p></li>
<li><p>MPI implementation: This is needed for the Carpet driver</p></li>
<li><p>Standard development tools: Perl, etc.</p></li>
</ul>
<div class="section" id="linux">
<h3>Linux<a class="headerlink" href="#linux" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># On Debian/Ubuntu/Mint use this command:</span>
$ sudo apt-get install -y subversion gcc git numactl libgsl-dev libpapi-dev python libhwloc-dev make libopenmpi-dev libhdf5-openmpi-dev libfftw3-dev libssl-dev liblapack-dev g++ curl gfortran patch pkg-config libhdf5-dev libjpeg-turbo?-dev
<span class="c1"># On Fedora use this command:</span>
$ sudo dnf install -y libjpeg-turbo-devel gcc git lapack-devel make subversion gcc-c++ which papi-devel python hwloc-devel openmpi-devel hdf5-openmpi-devel openssl-devel libtool-ltdl-devel numactl-devel gcc-gfortran findutils hdf5-devel fftw-devel patch gsl-devel pkgconfig
$ module load mpi/openmpi-x86_64 <span class="c1"># You will have to repeat the module load command each time you would like to compile or run the code.</span>
<span class="c1"># On Centos use this command:</span>
$ sudo yum install -y epel-release
$ sudo yum install -y libjpeg-turbo-devel gcc git lapack-devel make subversion gcc-c++ which papi-devel hwloc-devel openmpi-devel hdf5-openmpi-devel openssl-devel libtool-ltdl-devel numactl-devel gcc-gfortran hdf5-devel fftw-devel patch gsl-devel
</pre></div>
</div>
</div>
<div class="section" id="mac">
<h3>Mac<a class="headerlink" href="#mac" title="Permalink to this headline">¶</a></h3>
<div class="section" id="macports">
<h4>MacPorts<a class="headerlink" href="#macports" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p>Install Xcode from the Apple App Store. In addition agree to Xcode license in Terminal</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo xcodebuild -license
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>install <a class="reference external" href="https://www.macports.org/install.php">MacPorts</a> for your version of the Mac operating system, if you did not already install it</p></li>
<li><p>Next, please install the following packages, using the commands:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo port -N install pkgconfig gcc9 openmpi-gcc9 fftw-3 gsl jpeg zlib hdf5 +fortran +gfortran openssl ld64 +ld64_xcode
$ sudo port <span class="k">select</span> mpi openmpi-gcc9-fortran
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="homebrew">
<h4>Homebrew<a class="headerlink" href="#homebrew" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p>Install <a class="reference external" href="https://brew.sh">Homebrew</a></p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ /usr/bin/ruby -e <span class="s2">&quot;</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Next, please install the following packages, using the commands:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ brew install gnuplot pkg-config gcc fftw gsl hdf5 hwloc jpeg openssl pkg-config szip open-mpi
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="getcomponents-tools">
<h2>GetComponents Tools<a class="headerlink" href="#getcomponents-tools" title="Permalink to this headline">¶</a></h2>
<p>A script called GetComponents is used to fetch the components of the Einstein Toolkit. You may download and make it executable it as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/
$ curl -kLO https://raw.githubusercontent.com/gridaphobe/CRL/ET_2019_03/GetComponents
$ chmod u+x GetComponents
</pre></div>
</div>
<p>Below checks out Cactus, the Einstein Toolkit thorns, the Simulation Factory and example parameter files into a directory named Cactus.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./GetComponents --parallel https://bitbucket.org/einsteintoolkit/manifest/raw/ET_2019_03/einsteintoolkit.th
</pre></div>
</div>
<div class="admonition error">
<p class="admonition-title">Error</p>
<ul>
<li><p>Some versions of svn might show problems with the parallel checkout. If you see errors like (svn: E155037: Previous operation has not finished), try without the –parallel option.</p></li>
<li><p>svn: E155004: Could not update module &lt;Thorn&gt;</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> &lt;Thorn_Path&gt;
$ svn cleanup
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="the-traditional-way-of-compiling-cactus">
<h2>The traditional way of compiling Cactus<a class="headerlink" href="#the-traditional-way-of-compiling-cactus" title="Permalink to this headline">¶</a></h2>
<p>The traditional way of compiling Cactus without SimFactory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ make ET-config <span class="nv">options</span><span class="o">=</span>&lt;*.cfg&gt; <span class="nv">THORNLIST</span><span class="o">=</span>&lt;thornlist&gt;
</pre></div>
</div>
<p>This creates a configuration called “ET”, but any other name could be chosen here.</p>
<p>Once the configuration is done, the compilation process is simply</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ make -j &lt;number of processes&gt; ET
</pre></div>
</div>
<p>If everything is compiled correctly, the executable <em>cactus_ET</em> will be created under <em>./exe/</em>.</p>
<p>The typical procedure for running is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mpirun -np &lt;num procs&gt; ./exe/cactus_ET &lt;parameter file&gt;
</pre></div>
</div>
</div>
<div class="section" id="simfactory-tools">
<h2>SimFactory Tools<a class="headerlink" href="#simfactory-tools" title="Permalink to this headline">¶</a></h2>
<p>SimFactory needs to be configured before it can be used. The recommended way to do this is to use the setup command. SimFactory contains general support for specific operating systems commonly used on workstations or laptops, including Mac OS, Ubuntu, Cent OS and Scientific Linux. To configure SimFactory for one of these, you need to find the suitable files in <em>simfactory/mdb/optionlists</em> and <em>simfactory/mdb/runscripts</em> and specify their names on the sim setup command line.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Newer versions do not have ubuntu.cfg. All flavors of linux should compile with generic.cfg.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># for Debian</span>
$ ./simfactory/bin/sim setup-silent --optionlist<span class="o">=</span>debian.cfg --runscript debian.sh
<span class="c1"># for Ubuntu, Mint</span>
$ ./simfactory/bin/sim setup-silent --optionlist<span class="o">=</span>ubuntu.cfg --runscript debian.sh
<span class="c1"># for Fedora (you may have to log out and back in if you have just intalled mpich to make the module command work)</span>
$ module load mpi
$ ./simfactory/bin/sim setup-silent --optionlist<span class="o">=</span>fedora.cfg --runscript debian.sh
<span class="c1"># OSX+MacPorts</span>
$ ./simfactory/bin/sim setup-silent --optionlist<span class="o">=</span>osx-macports.cfg --runscript osx-macports.run
<span class="c1"># OSX+Homebrew</span>
$ ./simfactory/bin/sim setup-silent --optionlist<span class="o">=</span>osx-homebrew.cfg --runscript generic-mpi.run
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Generally, configuring SimFactory means providing an optionlist, for specifying library locations and build options, a submit script for using the batch queueing system, and a runscript, for specifying how Cactus should be run, e.g. which mpirun command to use.</p>
</div>
<p>Follow the on-screen prompts. This will output your choices in the configuration file <em>simfactory/etc/defs.local.ini</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is likely that you will have to further customise this file. You can see some possible option settings in <em>simfactory/etc/defs.local.ini.example</em>.</p>
</div>
<p>SimFactory needs to have a machine definition for every machine that it is run on. If you are using a machine that SimFactory already has a definition for, such as a well-known supercomputer used by others in the Cactus community, then no additional setup is required. If, however, you are running SimFactory on an individual laptop or on an unsupported supercomputer, the setup command will also create a new machine definition for the local machine in <em>./repos/simfactory2/mdb/machines/&lt;hostname&gt;.ini</em>. You may also have to add extra information to this file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A machine consists of a certain number of nodes, each of which consists of a certain number of cores.</p>
<p>The user chooses the total number of threads (–procs). The user can also choose the number of threads per process (–num-threads) and the number of threads per core (–num-smt). Additionally, the user can also specify the number of cores per node (–ppn) and the number of threads per node (–ppn-used). The number of nodes is always chosen automatically.</p>
<p>Note that nodes and cores are requested from the queuing system, while processes and threads are started by SimFactory.</p>
<p>For more details you can see <a class="reference external" href="https://simfactory.bitbucket.io/simfactory2/userguide/processterminology.html">https://simfactory.bitbucket.io/simfactory2/userguide/processterminology.html</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The main SimFactory binary is called “sim” and is located in simfactory/bin. You can execute SimFactory explicitly as ./simfactory/bin/sim, but we recommend that you set up a shell alias in your shell startup file so that you can just use the command “sim”. For bash users this file is .bashrc on Linux. Add the following to the shell startup file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">alias</span> <span class="nv">sim</span><span class="o">=</span>./simfactory/bin/sim
</pre></div>
</div>
</div>
<div class="admonition error">
<p class="admonition-title">Error</p>
<ul>
<li><p>checking whether the C compiler (gcc-8 -g -std=c11 -lgfortran) works… no</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">osx</span><span class="o">-</span><span class="n">homebrew</span><span class="o">.</span><span class="n">cfg</span><span class="p">]</span>
<span class="n">CPP</span> <span class="o">=</span> <span class="n">cpp</span><span class="o">-</span><span class="mi">9</span>
<span class="n">FPP</span> <span class="o">=</span> <span class="n">cpp</span><span class="o">-</span><span class="mi">9</span>
<span class="n">CC</span>  <span class="o">=</span> <span class="n">gcc</span><span class="o">-</span><span class="mi">9</span>
<span class="n">CXX</span> <span class="o">=</span> <span class="n">g</span><span class="o">++-</span><span class="mi">9</span>
<span class="n">F90</span> <span class="o">=</span> <span class="n">gfortran</span><span class="o">-</span><span class="mi">9</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="building-the-einstein-toolkit">
<h3>Building the Einstein Toolkit<a class="headerlink" href="#building-the-einstein-toolkit" title="Permalink to this headline">¶</a></h3>
<p>Assuming that SimFactory has been successfully set up on your machine, you should be able to build the Einstein Toolkit with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./simfactory/bin/sim build --mdbkey make <span class="s1">&#39;make -j2&#39;</span> --thornlist ../einsteintoolkit.th <span class="p">|</span> cat
</pre></div>
</div>
<p>The most important argument to this command is the <em>–thornlist</em> option, as this tells Cactus which thorns from your source tree you want to include in the configuration.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that, typically, one will not be compiling all the thorns provided with the ET. Compilation is time-consuming, and different configurations also take a significant amount of disk space. One therefore typically builds a thornlist that is as small as possible, including only the required thorns. Care should be taken, though, as there are often non-trivial dependencies between thorns. If one thorn which is required by another thorn is not mentioned in the thornlist, compilation will abort (with the corresponding error message).</p>
</div>
</div>
<div class="section" id="running-the-einstein-toolkit">
<h3>Running the Einstein Toolkit<a class="headerlink" href="#running-the-einstein-toolkit" title="Permalink to this headline">¶</a></h3>
<p>Simulations must always be created before they can be submitted or run. Since it is very common to want to create a simulation and immediately submit or run it, SimFactory provides the <em>create-run</em> and <em>create-submit</em> commands. These commands create the simulation and then either run or submit it immediately.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are working on a laptop or workstation, you can run SimFactory simulations directly in your terminal without going via a queuing system. However, if you are running SimFactory on a supercomputer with a queuing system, you cannot run simulations directly using the run command - they must instead be submitted to the queuing system, such as the PBS queuing system.</p>
</div>
<p>SimFactory needs to know a name for the simulation as well as what parameter file to use. You can either specify the name on the command line and give the parameter file with the <em>–parfile</em> option.</p>
<p>example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./simfactory/bin/sim create-run static_tov --parfile<span class="o">=</span>par/static_tov_small_short.par --procs<span class="o">=</span><span class="m">2</span> --num-threads<span class="o">=</span><span class="m">1</span> --ppn-used<span class="o">=</span><span class="m">2</span>  --walltime<span class="o">=</span><span class="m">8</span>:0:0 <span class="p">|</span> cat
</pre></div>
</div>
<p>It is often useful to use a parameter file script, rather than a parameter file, as a basic description of a simulation. For example, when performing a convergence test, many parameters might change between simulations, and changing them all manually is tedious and error-prone.</p>
<p>A parameter file script is a file with a “.rpar” extension which, when executed, generates a file in the same place but with a “.par” extension. You can write a parameter file script in any language.</p>
<div class="section" id="we-provide-examples-in-python">
<h4>We provide examples in python.<a class="headerlink" href="#we-provide-examples-in-python" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="k">import</span> <span class="n">Template</span>

<span class="n">dtfac</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">lines</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Time::dtfac                   = $dtfac</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(.*)\.rpar$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1.par&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Template</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="nb">locals</span><span class="p">()))</span>
</pre></div>
</div>
<p>These parameter file scripts look like standard Cactus parameter files but with $var variable replacements (in this case for the dtfac variable). You can define new variables and do calculations in the header and use the variables in the main body.</p>
<p>If you want to use the Cactus $parfile syntax, you need to escape the $</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>IO::out_dir = $$parfile
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Yu Liu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>