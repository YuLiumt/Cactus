

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Adaptive Mesh Refinement &mdash; Cactus 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Cactus
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GetStart.html">Get Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="main.html">Thorn Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ThornWrite/ThornWrite.html">Thorn Write</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Lorene/main.html">Lorene</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Kranc/Kranc.html">Kranc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reference.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cactus</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Adaptive Mesh Refinement</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/note/Guide/AMR.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adaptive-mesh-refinement">
<h1>Adaptive Mesh Refinement<a class="headerlink" href="#adaptive-mesh-refinement" title="Permalink to this headline">¶</a></h1>
<p>It is often the case in simulations of physical systems that the most interesting phenomena may occur in only a subset of the computational domain. In the other regions of the domain it may be possible to use a less accurate approximation, thereby reducing the computational resources required, and still obtain results which are essentially similar to those obtained if no such reduction is made.</p>
<p>In particular, we may consider using a computational mesh which is non-uniform in space and time, using a finer mesh resolution in the “interesting” regions where we expect it to be necessary, and using a coarser resolution in other areas. This is what we mean by mesh refinement (MR).</p>
<div class="section" id="carpet">
<h2>Carpet<a class="headerlink" href="#carpet" title="Permalink to this headline">¶</a></h2>
<p>Carpet is a mesh refinement driver for Cactus. It knows about a hierarchy of refinement levels, where each level is decomposed into a set of cuboid grid patches. The grid patch is the smallest unit of grid points that Carpet deals with. Carpet parallelises by assigning sets of grid patches to processors.</p>
<p>Each grid patch can be divided in up to four zones: the interior, the outer boundary, and the ghost zone, and the refinement boundary. The interior is where the actual compuations go on. The outer boundary is where the users’ outer boundary condition is applied; from Carpet’s point of view, these two are the same. The ghost zones are boundaries to other grid patches on the same refinement level (that might live on a different processor). The refinement boundary is the boundary of the refined region in a level, and it is filled by prolongation (interpolation) from the next coarser level.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Carpet does not handle staggered grids. Carpet does not provide cell-centered refinement. Carpet always enables all storage.</p>
</div>
<div class="graphviz"><object data="../../_images/graphviz-b54df3192f10905ca2c407cbbf9a06628048a803.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph foo {
&quot;Carpet&quot; -&gt; &quot;CarpetLib&quot;;
&quot;Carpet&quot; -&gt; &quot;IOUtil&quot;;
&quot;Carpet&quot; -&gt; &quot;MPI&quot;;
&quot;Carpet&quot; -&gt; &quot;Timers&quot;;
&quot;Carpet&quot; -&gt; &quot;LoopControl&quot;;
}</p></object></div>
<div class="section" id="parameter">
<h3>Parameter<a class="headerlink" href="#parameter" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Use the domain description from CoordBase to specify the global extent of the coarsest grid.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">domain_from_coordbase</span> <span class="o">=</span> <span class="n">yes</span>
</pre></div>
</div>
</li>
<li><p>Use the domain description from MultiPatch</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">domain_from_multipatch</span> <span class="o">=</span> <span class="n">yes</span>
</pre></div>
</div>
</li>
<li><p>Maximum number of refinement levels, including the base level</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">max_refinement_levels</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p>Ghost zones in each spatial direction</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Grid patches that are on the same refinement level never overlap except with their ghost zones. Conversly, all ghost zones must overlap with a non-ghost zone of another grid patch of the same level.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">ghost_size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="go">INFO (Carpet): Base grid specification for map 0:</span>
<span class="go">    number of coarse grid ghost points: [[3,3,3],[3,3,3]]</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Fill past time levels from current time level after calling initial data routines.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The boundary values of the finer grids have to be calculated from the coarser grids through interpolation. An because the time steps on the finer grids are smaller, there is not always a corresponding value on the coarser grids available. This makes it necessary to interpolate in time between time steps on the coarser grids. three time levels allow for a second order interpolation in time.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">init_fill_timelevels</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">init_3_timelevels</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span> <span class="c1"># Set up 3 timelevels of initial data</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Carpet currently supports polynomial interpolation, up to quadratic interpolation in time, which requires keeping at least two previous time levels of data. It also supports up to quintic interpolation in space, which requires using at least three ghost zones.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">prolongation_order_space</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">prolongation_order_time</span>  <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</li>
<li><p>Refinement factor</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">refinement_factor</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</li>
<li><p>Temporal refinement factors over the coarsest level</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">grid</span><span class="p">::</span><span class="n">dxyz</span> <span class="o">=</span> <span class="mi">18</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="p">::</span><span class="n">dtfac</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">max_refinement_levels</span>    <span class="o">=</span> <span class="mi">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">time_refinement_factors</span>  <span class="o">=</span> <span class="s2">&quot;[1,1,2,4,8,16,32]&quot;</span>
<span class="go">INFO (Time): Timestep set to 4.5 (courant_static)</span>
<span class="go">INFO (Time): Timestep set to 4.5 (courant_static)</span>
<span class="go">INFO (Time): Timestep set to 2.25 (courant_static)</span>
<span class="go">INFO (Time): Timestep set to 1.125 (courant_static)</span>
<span class="go">INFO (Time): Timestep set to 0.5625 (courant_static)</span>
<span class="go">INFO (Time): Timestep set to 0.28125 (courant_static)</span>
<span class="go">INFO (Time): Timestep set to 0.140625 (courant_static)</span>
</pre></div>
</div>
</li>
<li><p>Use buffer zones</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">use_buffer_zones</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
<span class="go">INFO (Carpet): Buffer zone counts (excluding ghosts):</span>
<span class="go">    [0]: [[0,0,0],[0,0,0]]</span>
<span class="go">    [1]: [[9,9,9],[9,9,9]]</span>
<span class="go">    [2]: [[9,9,9],[9,9,9]]</span>
<span class="go">    [3]: [[9,9,9],[9,9,9]]</span>
<span class="go">    [4]: [[9,9,9],[9,9,9]]</span>
<span class="go">    [5]: [[9,9,9],[9,9,9]]</span>
<span class="go">    [6]: [[9,9,9],[9,9,9]]</span>
</pre></div>
</div>
</li>
<li><p>Carpet uses vertex-centered refinement. That is, each coarse grid point coincides with a fine grid point.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">refinement_centering</span> <span class="o">=</span> <span class="s2">&quot;vertex&quot;</span>
</pre></div>
</div>
</li>
<li><p>Print detailed statistics periodically</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">output_timers_every</span> <span class="o">=</span> <span class="mi">512</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">schedule_barriers</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span> <span class="c1"># Insert barriers between scheduled items, so that timer statistics become more reliable (slows down execution)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">sync_barriers</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span> <span class="c1"># Insert barriers before and after syncs, so that the sync timer is more reliable (slows down execution)</span>
</pre></div>
</div>
</li>
<li><p>Try to catch uninitialised grid elements or changed timelevels.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>Checksumming and poisoning are means to find thorns that alter grid variables that should not be altered, or that fail to fill in grid variables that they should fill in.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">check_for_poison</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">poison_new_timelevels</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetLib</span><span class="p">::</span><span class="n">poison_new_memory</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetLib</span><span class="p">::</span><span class="n">poison_value</span>      <span class="o">=</span> <span class="mi">114</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Base Multigrid level and factor</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">convergence_level</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">convergence_factor</span> <span class="o">=</span> <span class="mi">2</span>
<span class="go">INFO (Carpet): Adapted domain specification for map 0:</span>
<span class="go">    convergence factor: 2</span>
<span class="go">    convergence level : 0</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="output">
<h3>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>File name to output grid coordinates.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">grid_coordinates_filename</span> <span class="o">=</span> <span class="s2">&quot;carpet-grid.asc&quot;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="warning">
<h3>Warning<a class="headerlink" href="#warning" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>INFO (Carpet): There are not enough time levels for the desired temporal prolongation order in the grid function group “ADMBASE::METRIC”.  With Carpet::prolongation_order_time=2, you need at least 3 time levels.</p></li>
</ul>
</div>
</div>
<div class="section" id="carpetlib">
<h2>CarpetLib<a class="headerlink" href="#carpetlib" title="Permalink to this headline">¶</a></h2>
<p>This thorn contains the backend library that provides mesh refinement. CarpetLib contains of three major parts:</p>
<ul>
<li><p>a set of generic useful helpers</p>
<blockquote>
<div><p>A class <code class="docutils literal notranslate"><span class="pre">vect&lt;T,D&gt;</span></code> provides small D-dimensional vectors of the type T. A vect corresponds to a grid point location. The class <code class="docutils literal notranslate"><span class="pre">bbox&lt;T,D&gt;</span></code> provides D-dimensional bounding boxes using type T as indices. A bbox defines the location and shape of a grid patch. Finally, <code class="docutils literal notranslate"><span class="pre">bboxset&lt;T,D&gt;</span></code> is a collection of bboxes.</p>
</div></blockquote>
</li>
<li><p>the grid hierarchy and data handling</p>
<blockquote>
<div><p>The grid hierarchy is described by a set of classes. Except for the actual data, all structures and all information is replicated on all processors.</p>
</div></blockquote>
</li>
<li><p>interpolation operators.</p>
<blockquote>
<div><p>The interpolators used for restriction and prolongation are different from those used for the generic interpolation interface in Cactus. The reason is that interpolation is expensive, and hence the interpolation operators used for restriction and prolongation have to be streamlined and optimised. As one knows the location of the sampling points for the interpolation, one can calculate the coefficients in advance, saving much time compared to calling a generic interpolation interface.</p>
</div></blockquote>
</li>
</ul>
<div class="graphviz"><object data="../../_images/graphviz-ec7290dfa044482f9ce5155e8f1f6d954dc19f75.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph foo {
&quot;CarpetLib&quot; -&gt; &quot;Vectors&quot;;
&quot;CarpetLib&quot; -&gt; &quot;CycleClock&quot;;
&quot;CarpetLib&quot; -&gt; &quot;Timers&quot;;
&quot;CarpetLib&quot; -&gt; &quot;LoopControl&quot;;
}</p></object></div>
<div class="section" id="id1">
<h3>Parameter<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Provide one extra ghost point during restriction for staggered operators.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetLib</span><span class="p">::</span><span class="n">support_staggered_operators</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="carpetregrid2">
<h2>CarpetRegrid2<a class="headerlink" href="#carpetregrid2" title="Permalink to this headline">¶</a></h2>
<p>Set up refined regions by specifying a set of centres and radii about them. All it does is take a regridding specification from the user and translate that into a <code class="docutils literal notranslate"><span class="pre">gh</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gh</span></code> is a grid hierarchy. It describes, for each refinement level, the location of the grid patches. This <code class="docutils literal notranslate"><span class="pre">gh</span></code> does not contain ghost zones or prolongation boundaries. There exists only one common <code class="docutils literal notranslate"><span class="pre">gh</span></code> for all grid functions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dh</span></code> is a data hierarchy. It extends the notion of a <code class="docutils literal notranslate"><span class="pre">gh</span></code> by ghost zones and prolongation boundaries. The <code class="docutils literal notranslate"><span class="pre">dh</span></code> does most of the bookkeeping work, deciding which grid patches interact with what other grid patches through synchronisation, prolongation, restriction, and boundary prolongation. As all grid functions have the same number of ghost zones, there exists also only one <code class="docutils literal notranslate"><span class="pre">dh</span></code> for all grid functions.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To regrid means to select a new set of grid patches for each refinement level. To recompose the grid hierarchy means to move data around. Regridding is only about bookkeeping, while recomposing is about data munging.</p>
</div>
<div class="graphviz"><object data="../../_images/graphviz-5f918ab20e451cb5aa1452013e8f8ab00e5d90bb.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph foo {
&quot;CarpetRegrid2&quot; -&gt; &quot;Carpet&quot;;
&quot;CarpetRegrid2&quot; -&gt; &quot;Timers&quot;;
}</p></object></div>
<div class="section" id="id2">
<h3>Parameter<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Set up refined regions by specifying a set of centres and radii about them.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">max_refinement_levels</span> <span class="o">=</span> <span class="mi">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">num_centres</span>    <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">num_levels_1</span>   <span class="o">=</span> <span class="mi">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">num_levels_2</span>   <span class="o">=</span> <span class="mi">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">position_x_1</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">15.2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">position_x_2</span>   <span class="o">=</span>  <span class="mf">15.2</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">radius_1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>    <span class="o">=</span>  <span class="mf">270.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">radius_1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>    <span class="o">=</span>  <span class="mf">162.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">radius_1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>    <span class="o">=</span>   <span class="mf">94.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">radius_1</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>    <span class="o">=</span>   <span class="mf">40.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">radius_1</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>    <span class="o">=</span>   <span class="mf">27.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">radius_1</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>    <span class="o">=</span>   <span class="mf">13.5</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">radius_2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>    <span class="o">=</span>  <span class="mf">270.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">radius_2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>    <span class="o">=</span>  <span class="mf">162.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">radius_2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>    <span class="o">=</span>   <span class="mf">94.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">radius_2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>    <span class="o">=</span>   <span class="mf">40.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">radius_2</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>    <span class="o">=</span>   <span class="mf">27.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">radius_2</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>    <span class="o">=</span>   <span class="mf">13.5</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">refinement_factor</span> <span class="o">=</span> <span class="mi">2</span>
<span class="go">INFO (CarpetRegrid2): Centre 1 is at position [-15.2,0,0] with 7 levels</span>
<span class="go">INFO (CarpetRegrid2): Centre 2 is at position [15.2,0,0] with 7 levels</span>
<span class="go">INFO (Carpet): Grid structure (superregions, coordinates):</span>
<span class="go">    [0][0][0]   exterior: [-576.000000000000000,-576.000000000000000,-576.000000000000000] : [576.000000000000000,576.000000000000000,576.000000000000000] : [18.000000000000000,18.000000000000000,18.000000000000000]</span>
<span class="go">    [1][0][0]   exterior: [-369.000000000000000,-351.000000000000000,-351.000000000000000] : [369.000000000000000,351.000000000000000,351.000000000000000] : [9.000000000000000,9.000000000000000,9.000000000000000]</span>
<span class="go">    [2][0][0]   exterior: [-216.000000000000000,-202.500000000000000,-202.500000000000000] : [216.000000000000000,202.500000000000000,202.500000000000000] : [4.500000000000000,4.500000000000000,4.500000000000000]</span>
<span class="go">    [3][0][0]   exterior: [-130.500000000000000,-114.750000000000000,-114.750000000000000] : [130.500000000000000,114.750000000000000,114.750000000000000] : [2.250000000000000,2.250000000000000,2.250000000000000]</span>
<span class="go">    [4][0][0]   exterior: [-66.375000000000000,-50.625000000000000,-50.625000000000000] : [66.375000000000000,50.625000000000000,50.625000000000000] : [1.125000000000000,1.125000000000000,1.125000000000000]</span>
<span class="go">    [5][0][0]   exterior: [-47.250000000000000,-32.062500000000000,-32.062500000000000] : [47.250000000000000,32.062500000000000,32.062500000000000] : [0.562500000000000,0.562500000000000,0.562500000000000]</span>
<span class="go">    [6][0][0]   exterior: [-31.218750000000000,-16.031250000000000,-16.031250000000000] : [31.218750000000000,16.031250000000000,16.031250000000000] : [0.281250000000000,0.281250000000000,0.281250000000000]</span>
</pre></div>
</div>
</li>
<li><p>Regrid every n time steps</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">regrid_every</span> <span class="o">=</span> <span class="mi">32</span> <span class="c1"># 2**(max_refinement_levels - 2)</span>
</pre></div>
</div>
</li>
<li><p>Minimum movement to trigger a regridding</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetRegrid2</span><span class="p">::</span><span class="n">movement_threshold_1</span> <span class="o">=</span> <span class="mf">0.10</span> <span class="c1"># Regrid only if the regions have changed sufficiently</span>
<span class="go">INFO (CarpetRegrid2): Refined regions have not changed sufficiently; skipping regridding</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="id3">
<h3>Warning<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>PARAMETER ERROR (CarpetRegrid2): The number of requested refinement levels is larger than the maximum number of levels specified by Carpet::max_refinement_levels</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Carpet</span><span class="p">::</span><span class="n">max_refinement_levels</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">number</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="volumeintegrals-grmhd">
<h2>VolumeIntegrals_GRMHD<a class="headerlink" href="#volumeintegrals-grmhd" title="Permalink to this headline">¶</a></h2>
<p>Thorn for integration of spacetime quantities. The center of mass (CoM) can be used to set the AMR center.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\rho_{*} = \alpha u^{0} \sqrt{det(g)} \rho_{0} = \Gamma \sqrt{det(g)} \rho_{0} \\
CoM^{i} = \frac{\int \rho_{*} x^{i} dV}{\int \rho_{*} dV}\end{split}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In a binary neutron star simulation, the maximum density is <span class="math notranslate nohighlight">\(\sim 1\)</span>, with atmosphere values surrounding the stars of at most <span class="math notranslate nohighlight">\(\sim\)</span> 1e-6. The concern is that a bad conservatives-to-primitives inversion called before this diagnostic might cause Gamma to be extremely large. Capping Gamma at 1e4 should prevent the CoM integral from being thrown off significantly, which would throw off the NS tracking.</p>
</div>
<div class="graphviz"><object data="../../_images/graphviz-a2000c46fab65cda682dafbf17ba20f90862e635.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph foo {
&quot;VolumeIntegrals_GRMHD&quot; -&gt; &quot;CartGrid3D&quot;;
&quot;VolumeIntegrals_GRMHD&quot; -&gt; &quot;HydroBase&quot;;
&quot;VolumeIntegrals_GRMHD&quot; -&gt; &quot;ADMBase&quot;;
&quot;VolumeIntegrals_GRMHD&quot; -&gt; &quot;CarpetRegrid2&quot;;
}</p></object></div>
<div class="section" id="id4">
<h3>Parameter<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Set verbosity level: 1=useful info; 2=moderately annoying (though useful for debugging)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p>How often to compute volume integrals?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">VolIntegral_out_every</span> <span class="o">=</span> <span class="mi">32</span> <span class="c1"># 2**(max_refinement_levels - 2)</span>
</pre></div>
</div>
</li>
<li><p>Number of volume integrals to perform</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">NumIntegrals</span> <span class="o">=</span> <span class="mi">6</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Integrate the entire volume with an integrand of 1. (used for testing/validation purposes only).</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">Integration_quantity_keyword</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;one&quot;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># To compute the center of mass in an integration volume originally centered at (x,y,z) = (-15.2,0,0) with a coordinate radius of 13.5. Also use the center of mass integral result to set the ZEROTH AMR center.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">Integration_quantity_keyword</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;centerofmass&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">volintegral_sphere__center_x_initial</span>         <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">15.2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">volintegral_inside_sphere__radius</span>            <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">13.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">amr_centre__tracks__volintegral_inside_sphere</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span>  <span class="mi">0</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Same as above, except use the integrand=1 (for validation purposes, to ensure the integration volume is approximately 4/3*pi*13.5^3).</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">Integration_quantity_keyword</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;one&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">volintegral_sphere__center_x_initial</span>         <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">15.2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">volintegral_inside_sphere__radius</span>            <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">13.5</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The neutron star originally centered at (x,y,z) = (+15.2,0,0). Also use the center of mass integral result to set the ONETH AMR center.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">Integration_quantity_keyword</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;centerofmass&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">volintegral_sphere__center_x_initial</span>         <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">15.2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">volintegral_inside_sphere__radius</span>            <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">13.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">amr_centre__tracks__volintegral_inside_sphere</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span>  <span class="mi">1</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Same as above, except use the integrand=1 (for validation purposes, to ensure the integration volume is approximately 4/3*pi*13.5^3).</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">Integration_quantity_keyword</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;one&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">volintegral_sphere__center_x_initial</span>         <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">15.2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">volintegral_inside_sphere__radius</span>            <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">13.5</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Perform rest-mass integrals over entire volume.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">Integration_quantity_keyword</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;restmass&quot;</span>
</pre></div>
</div>
</li>
<li><p>Enable output file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">enable_file_output</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">outVolIntegral_dir</span> <span class="o">=</span> <span class="s2">&quot;volume_integration&quot;</span>
</pre></div>
</div>
</li>
<li><p>Gamma speed limit</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">VolumeIntegrals_GRMHD</span><span class="p">::</span><span class="n">CoM_integrand_GAMMA_SPEED_LIMIT</span> <span class="o">=</span> <span class="mf">1e4</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="carpettracker">
<h2>CarpetTracker<a class="headerlink" href="#carpettracker" title="Permalink to this headline">¶</a></h2>
<p>Object coordinates are updated by CarpetTracker, which provides a simple interface to the object trackers PunctureTracker and NSTracker in order to have the refined region follow the moving objects.</p>
<div class="graphviz"><object data="../../_images/graphviz-dc1ca4544d5115387037644e19697505ad907da8.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph foo {
&quot;CarpetTracker&quot; -&gt; &quot;SphericalSurface&quot;;
&quot;CarpetTracker&quot; -&gt; &quot;CarpetRegrid2&quot;;
}</p></object></div>
<div class="section" id="id5">
<h3>Parameter<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Spherical surface index or name which is the source for the location of the refine regions. (Maximum number of tracked surfaces less than 10)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetTracker</span><span class="p">::</span><span class="n">surface</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="go">&lt;surface index&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetTracker</span><span class="p">::</span><span class="n">surface_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Righthand NS&quot;</span>
<span class="go">&lt;surface name&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="nstracker">
<h2>NSTracker<a class="headerlink" href="#nstracker" title="Permalink to this headline">¶</a></h2>
<p>This thorn can track the location of a neutron star, e.g. to
guide mesh refinement.</p>
<div class="graphviz"><object data="../../_images/graphviz-5f78535f9ec61c1a2866b0aa3d6946b9e6fdc868.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph foo {
&quot;NSTracker&quot; -&gt; &quot;SphericalSurface&quot;;
&quot;NSTracker&quot; -&gt; &quot;Hydro_Analysis&quot;;
}</p></object></div>
<div class="section" id="id6">
<h3>Parameter<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Index or Name of the sperical surface which should be moved around</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">NSTracker</span><span class="p">::</span><span class="n">NSTracker_SF_Name</span>          <span class="o">=</span> <span class="s2">&quot;Righthand NS&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NSTracker</span><span class="p">::</span><span class="n">NSTracker_SF_Name_Opposite</span> <span class="o">=</span> <span class="s2">&quot;Lefthand NS&quot;</span>
<span class="go">&lt;surface name&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NSTracker</span><span class="p">::</span><span class="n">NSTracker_SF_Index</span>          <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NSTracker</span><span class="p">::</span><span class="n">NSTracker_SF_Index_Opposite</span> <span class="o">=</span> <span class="mi">1</span>
<span class="go">&lt;surface index&gt;</span>
</pre></div>
</div>
</li>
<li><p>Allowed to move if new location is not too far from old.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">NSTracker</span><span class="p">::</span><span class="n">NSTracker_max_distance</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
</li>
<li><p>grid scalar group containing coordinates of center of star</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">NSTracker</span><span class="p">::</span><span class="n">NSTracker_tracked_location</span> <span class="o">=</span> <span class="s2">&quot;Hydro_Analysis::Hydro_Analysis_rho_max_loc&quot;</span> <span class="c1"># location of maximum</span>
<span class="go">position_x[NSTracker_SF_Index] = Hydro_Analysis_rho_max_loc</span>
<span class="go">position_x[NSTracker_SF_Index_Opposite] = - Hydro_Analysis_rho_max_loc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NSTracker</span><span class="p">::</span><span class="n">NSTracker_tracked_location</span> <span class="o">=</span> <span class="s2">&quot;Hydro_Analysis::Hydro_Analysis_rho_core_center_volume_weighted&quot;</span> <span class="c1"># center of mass</span>
</pre></div>
</div>
</li>
<li><p>Time after which to stop updating the SF</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">NSTracker</span><span class="p">::</span><span class="n">NSTracker_stop_time</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="hydro-analysis">
<h2>Hydro_Analysis<a class="headerlink" href="#hydro-analysis" title="Permalink to this headline">¶</a></h2>
<p>This thorn provides basic hydro analysis routines.</p>
<div class="graphviz"><object data="../../_images/graphviz-e0964f74ea6c256f09bffcbad904f30413b57e2b.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph foo {
&quot;Hydro_Analysis&quot; -&gt; &quot;HydroBase&quot;;
&quot;Hydro_Analysis&quot; -&gt; &quot;ADMBase&quot;;
&quot;Hydro_Analysis&quot; -&gt; &quot;CartGrid3D&quot;;
}</p></object></div>
<div class="section" id="id7">
<h3>Parameter<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Look for the value and location of the maximum of rho</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Hydro_Analysis</span><span class="p">::</span><span class="n">Hydro_Analysis_comp_rho_max</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Hydro_Analysis</span><span class="p">::</span><span class="n">Hydro_Analysis_average_multiple_maxima_locations</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span> <span class="c1"># when finding more than one global maximum location, average position</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Hydro_Analysis</span><span class="p">::</span><span class="n">Hydro_Analysis_comp_rho_max_every</span> <span class="o">=</span> <span class="mi">32</span> <span class="c1"># 2**(max_refinement_levels - 2)</span>
</pre></div>
</div>
</li>
<li><p>Look for the location of the volume-weighted center of mass</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Hydro_Analysis</span><span class="p">::</span><span class="n">Hydro_Analysis_comp_vol_weighted_center_of_mass</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
</pre></div>
</div>
</li>
<li><p>Look for the proper distance between the maximum of the density and the origin (along a straight coordinate line, not a geodesic)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Hydro_Analysis</span><span class="p">::</span><span class="n">Hydro_Analysis_comp_rho_max_origin_distance</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ActiveThorns</span> <span class="o">=</span> <span class="s2">&quot;AEILocalInterp&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Hydro_Analysis</span><span class="p">::</span><span class="n">Hydro_Analysis_interpolator_name</span> <span class="o">=</span> <span class="s2">&quot;Lagrange polynomial interpolation (tensor product)&quot;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="id8">
<h3>Output<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Coordinate location of the maximum of rho</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">IOScalar</span><span class="p">::</span><span class="n">outScalar_vars</span> <span class="o">=</span> <span class="s2">&quot;Hydro_Analysis_rho_max&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IOScalar</span><span class="p">::</span><span class="n">outScalar_vars</span> <span class="o">=</span> <span class="s2">&quot;Hydro_Analysis::Hydro_Analysis_rho_max_loc&quot;</span>
</pre></div>
</div>
</li>
<li><p>coordinate location of the volume weightes center of mass</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">IOScalar</span><span class="p">::</span><span class="n">outScalar_vars</span> <span class="o">=</span> <span class="s2">&quot;Hydro_Analysis_rho_center_volume_weighted&quot;</span>
</pre></div>
</div>
</li>
<li><p>proper distance between the maximum of the density and the origin (along a straight coordinate line)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">IOScalar</span><span class="p">::</span><span class="n">outScalar_vars</span> <span class="o">=</span> <span class="s2">&quot;Hydro_Analysis::Hydro_Analysis_rho_max_origin_distance&quot;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="id9">
<h3>Warning<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Cannot get handle for interpolation ! Forgot to activate an implementation providing interpolation operators (e.g. LocalInterp)?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ActiveThorns</span> <span class="o">=</span> <span class="s2">&quot;LocalInterp&quot;</span>
</pre></div>
</div>
</li>
<li><p>No driver thorn activated to provide an interpolation routine for grid arrays</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ActiveThorns</span> <span class="o">=</span> <span class="s2">&quot;CarpetInterp&quot;</span>
</pre></div>
</div>
</li>
<li><p>No handle found for interpolation operator ‘Lagrange polynomial interpolation (tensor product)’</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ActiveThorns</span> <span class="o">=</span> <span class="s2">&quot;AEILocalInterp&quot;</span>
</pre></div>
</div>
</li>
<li><p>No handle: ‘-2’ found for reduction operator ‘sum’</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ActiveThorns</span> <span class="o">=</span> <span class="s2">&quot;LocalReduce&quot;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="puncturetracker">
<h2>PunctureTracker<a class="headerlink" href="#puncturetracker" title="Permalink to this headline">¶</a></h2>
<p>PunctureTracker track BH positions evolved with moving puncture techniques. The BH position is stored as the centroid of a spherical surface (even though there is no surface) provided by SphericalSurface.</p>
<div class="math notranslate nohighlight">
\[pt\_loc = pt\_loc\_p - dt \times pt\_beta\]</div>
<div class="graphviz"><object data="../../_images/graphviz-0a321e5d2273a38964fc9528f6ffed9156d22f19.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph foo {
&quot;PunctureTracker&quot; -&gt; &quot;SphericalSurface&quot;;
&quot;PunctureTracker&quot; -&gt; &quot;CarpetRegrid2&quot;;
&quot;PunctureTracker&quot; -&gt; &quot;ADMBase&quot;;
}</p></object></div>
<div class="section" id="id10">
<h3>Parameter<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>A spherical surface index where we can store the puncture location</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">PunctureTracker</span><span class="p">::</span><span class="n">which_surface_to_store_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PunctureTracker</span><span class="p">::</span><span class="n">track</span>                      <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">yes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PunctureTracker</span><span class="p">::</span><span class="n">initial_x</span>                  <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PunctureTracker</span><span class="p">::</span><span class="n">which_surface_to_store_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PunctureTracker</span><span class="p">::</span><span class="n">track</span>                      <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">yes</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PunctureTracker</span><span class="p">::</span><span class="n">initial_x</span>                  <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="id11">
<h3>Warning<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>No handle found for interpolation operator ‘Lagrange polynomial interpolation’</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ActiveThorns</span> <span class="o">=</span> <span class="s2">&quot;AEILocalInterp&quot;</span>
</pre></div>
</div>
</li>
<li><p>Error</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ActiveThorns</span> <span class="o">=</span> <span class="s2">&quot;SphericalSurface&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">SphericalSurface</span><span class="p">::</span><span class="n">nsurfaces</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">SphericalSurface</span><span class="p">::</span><span class="n">maxntheta</span> <span class="o">=</span> <span class="mi">66</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">SphericalSurface</span><span class="p">::</span><span class="n">maxnphi</span>   <span class="o">=</span> <span class="mi">124</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">SphericalSurface</span><span class="p">::</span><span class="n">verbose</span>   <span class="o">=</span> <span class="n">yes</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="id12">
<h3>Output<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Location of punctures</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">IOASCII</span><span class="p">::</span><span class="n">out0D_vars</span> <span class="o">=</span> <span class="s2">&quot;PunctureTracker::pt_loc&quot;</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="carpetinterp-carpetinterp2">
<h2>CarpetInterp/CarpetInterp2<a class="headerlink" href="#carpetinterp-carpetinterp2" title="Permalink to this headline">¶</a></h2>
<p>This thorn provides a parallel interpolator for Carpet.</p>
<div class="graphviz"><object data="../../_images/graphviz-35fcd155a5f8ed0cac8781931e6f80059351b5a7.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph foo {
&quot;CarpetInterp2&quot; -&gt; &quot;Carpet&quot;;
&quot;CarpetInterp2&quot; -&gt; &quot;Timers&quot;;
}</p></object></div>
</div>
<div class="section" id="carpetreduce">
<h2>CarpetReduce<a class="headerlink" href="#carpetreduce" title="Permalink to this headline">¶</a></h2>
<p>This thorn provides parallel reduction operators for Carpet. This thorn now uses a weight function. The weight is 1 for all “normal” grid points.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The weight is set to 0 on symmetry and possible the outer boundary, and it might be set to <span class="math notranslate nohighlight">\(1/2\)</span> on the edge of the boundary. The weight is also reduced or set to 0 on coarser grids that are overlaid by finer grid.</p>
</div>
<div class="graphviz"><object data="../../_images/graphviz-72261cc086c1b59df97aa9c555ca9f87869a2143.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph foo {
&quot;CarpetReduce&quot; -&gt; &quot;Carpet&quot;;
&quot;CarpetReduce&quot; -&gt; &quot;LoopControl&quot;;
}</p></object></div>
</div>
<div class="section" id="carpetmask">
<h2>CarpetMask<a class="headerlink" href="#carpetmask" title="Permalink to this headline">¶</a></h2>
<p>Remove unwanted regions from Carpet’s reduction operations. This can be used to excise the interior of horizons.</p>
<div class="graphviz"><object data="../../_images/graphviz-700c5c63e8d3b306190e41fa925a2166934de11d.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph foo {
&quot;CarpetMask&quot; -&gt; &quot;CartGrid3D&quot;;
&quot;CarpetMask&quot; -&gt; &quot;SphericalSurface&quot;;
}</p></object></div>
<div class="section" id="id13">
<h3>Parameter<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Exclude spherical surfaces with shrink factor</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>iweight = 0 if dr &lt;= radius_{sf} * excluded_surface_factor</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetMask</span><span class="p">::</span><span class="n">excluded_surface</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># index of excluded surface</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CarpetMask</span><span class="p">::</span><span class="n">excluded_surface_factor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Yu Liu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>